{"version":3,"sources":["../src/math.ts","../src/fft.ts","../src/fractional_octave_smoothing.ts","../src/audio.ts","../src/windows.ts","../src/plotting.ts","../src/farina.ts","../src/storage.ts","../src/device-settings.ts","../src/recorder.ts","../src/wave.ts","../src/app.ts"],"sourcesContent":["console.debug(\"Math module loaded\");\n\nexport function logspace(start: number, end: number, num: number): Float32Array {\n    const logStart = Math.log10(start);\n    const logEnd = Math.log10(end);\n    const logStep = (logEnd - logStart) / (num - 1);\n    return Float32Array.from({ length: num }, (_, i) => Math.pow(10, logStart + i * logStep));\n}\n\nexport function linspace(start: number, end: number, num: number): Float32Array {\n    if (num === 1) return Float32Array.from([start]);\n    const step = (end - start) / (num - 1);\n    return Float32Array.from({ length: num }, (_, i) => start + i * step);\n}\n\nexport function closest(num: number, arr: Float32Array): number {\n    let curr = arr[0];\n    let diff = Math.abs(num - curr);\n    let index = 0;\n    for (let val = 0; val < arr.length; val++) {\n        const newDiff = Math.abs(num - arr[val]);\n        if (newDiff < diff) {\n            diff = newDiff;\n            curr = arr[val];\n            index = val;\n        }\n    }\n    return index;\n}\n\nexport function clamp(v: number, lower: number, upper: number): number {\n    return Math.max(lower, Math.min(upper, v));\n}\n\nexport const average = (array: Float32Array): number => array.reduce((a, b) => a + b) / array.length;\n\nexport const abs = (re: number, im: number = 0): number => Math.sqrt(re * re + im * im);\n\nexport const mod = (n: number, m: number): number => ((n % m) + m) % m;\n\nexport const nextPow2 = (v: number): number => {\n        let p = 1;\n        while (p < v) p <<= 1;\n        return p;\n    };\n\nexport function max(arr: Float32Array): number {\n    let maxVal = -Infinity;\n    for (let i = 0; i < arr.length; i++) {\n        if (arr[i] > maxVal) maxVal = Math.abs(arr[i]);\n    }\n    return maxVal;\n}","/* This software is licensed under the MIT License.\n\nCopyright Fedor Indutny, 2017.\n\nPermission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the \"Software\"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE. */\n\nconsole.debug(\"FFT module loaded\");\n\nexport class FFT {\n  size: number;\n  private _csize: number;\n  table: number[];\n  private _width: number;\n  private _bitrev: number[];\n  private _out: number[] | null;\n  private _data: number[] | null;\n  private _inv: number;\n\n  constructor(size: number) {\n    this.size = size | 0;\n    if (this.size <= 1 || (this.size & (this.size - 1)) !== 0)\n      throw new Error('FFT size must be a power of two and bigger than 1');\n\n    this._csize = size << 1;\n\n    // NOTE: Use of `var` is intentional for old V8 versions\n    const table = new Array<number>(this.size * 2);\n    for (let i = 0; i < table.length; i += 2) {\n      const angle = Math.PI * i / this.size;\n      table[i] = Math.cos(angle);\n      table[i + 1] = -Math.sin(angle);\n    }\n    this.table = table;\n\n    // Find size's power of two\n    let power = 0;\n    for (let t = 1; this.size > t; t <<= 1)\n      power++;\n\n    // Calculate initial step's width:\n    //   * If we are full radix-4 - it is 2x smaller to give inital len=8\n    //   * Otherwise it is the same as `power` to give len=4\n    this._width = power % 2 === 0 ? power - 1 : power;\n\n    // Pre-compute bit-reversal patterns\n    this._bitrev = new Array<number>(1 << this._width);\n    for (let j = 0; j < this._bitrev.length; j++) {\n      this._bitrev[j] = 0;\n      for (let shift = 0; shift < this._width; shift += 2) {\n        const revShift = this._width - shift - 2;\n        this._bitrev[j] |= ((j >>> shift) & 3) << revShift;\n      }\n    }\n\n    this._out = null;\n    this._data = null;\n    this._inv = 0;\n  }\n\n  fromComplexArray(complex: number[] | Float32Array, storage?: number[] | Float32Array): number[] | Float32Array {\n    const res = storage || new Array<number>(complex.length >>> 1);\n    for (let i = 0; i < complex.length; i += 2)\n      res[i >>> 1] = complex[i];\n    return res;\n  }\n\n  createComplexArray(): number[] {\n    const res = new Array<number>(this._csize);\n    for (let i = 0; i < res.length; i++)\n      res[i] = 0;\n    return res;\n  }\n\n  toComplexArray(input: number[] | Float32Array, storage?: number[] | Float32Array): number[] | Float32Array {\n    const res = storage || this.createComplexArray();\n    for (let i = 0; i < res.length; i += 2) {\n      res[i] = input[i >>> 1];\n      res[i + 1] = 0;\n    }\n    return res;\n  }\n\n  completeSpectrum(spectrum: number[] | Float32Array): void {\n    const size = this._csize;\n    const half = size >>> 1;\n    for (let i = 2; i < half; i += 2) {\n      spectrum[size - i] = spectrum[i];\n      spectrum[size - i + 1] = -spectrum[i + 1];\n    }\n  }\n\n  transform(out: number[] | Float32Array, data: number[] | Float32Array): void {\n    if (out === data)\n      throw new Error('Input and output buffers must be different');\n\n    this._out = out as number[];\n    this._data = data as number[];\n    this._inv = 0;\n    this._transform4();\n    this._out = null;\n    this._data = null;\n  }\n\n  realTransform(out: number[] | Float32Array, data: number[] | Float32Array): void {\n    if (out === data)\n      throw new Error('Input and output buffers must be different');\n\n    this._out = out as number[];\n    this._data = data as number[];\n    this._inv = 0;\n    this._realTransform4();\n    this._out = null;\n    this._data = null;\n  }\n\n  inverseTransform(out: number[] | Float32Array, data: number[] | Float32Array): void {\n    if (out === data)\n      throw new Error('Input and output buffers must be different');\n\n    this._out = out as number[];\n    this._data = data as number[];\n    this._inv = 1;\n    this._transform4();\n    for (let i = 0; i < out.length; i++)\n      out[i] /= this.size;\n    this._out = null;\n    this._data = null;\n  }\n\n  // radix-4 implementation\n  //\n  // NOTE: Uses of `var` are intentional for older V8 version that do not\n  // support both `let compound assignments` and `const phi`\n  private _transform4(): void {\n    const out = this._out!;\n    const size = this._csize;\n\n    // Initial step (permute and transform)\n    const width = this._width;\n    let step = 1 << width;\n    let len = (size / step) << 1;\n\n    let outOff: number;\n    let t: number;\n    const bitrev = this._bitrev;\n    if (len === 4) {\n      for (outOff = 0, t = 0; outOff < size; outOff += len, t++) {\n        const off = bitrev[t];\n        this._singleTransform2(outOff, off, step);\n      }\n    } else {\n      // len === 8\n      for (outOff = 0, t = 0; outOff < size; outOff += len, t++) {\n        const off = bitrev[t];\n        this._singleTransform4(outOff, off, step);\n      }\n    }\n\n    // Loop through steps in decreasing order\n    const inv = this._inv ? -1 : 1;\n    const table = this.table;\n    for (step >>= 2; step >= 2; step >>= 2) {\n      len = (size / step) << 1;\n      const quarterLen = len >>> 2;\n\n      // Loop through offsets in the data\n      for (outOff = 0; outOff < size; outOff += len) {\n        // Full case\n        const limit = outOff + quarterLen;\n        for (let i = outOff, k = 0; i < limit; i += 2, k += step) {\n          const A = i;\n          const B = A + quarterLen;\n          const C = B + quarterLen;\n          const D = C + quarterLen;\n\n          // Original values\n          const Ar = out[A];\n          const Ai = out[A + 1];\n          const Br = out[B];\n          const Bi = out[B + 1];\n          const Cr = out[C];\n          const Ci = out[C + 1];\n          const Dr = out[D];\n          const Di = out[D + 1];\n\n          // Middle values\n          const MAr = Ar;\n          const MAi = Ai;\n\n          const tableBr = table[k];\n          const tableBi = inv * table[k + 1];\n          const MBr = Br * tableBr - Bi * tableBi;\n          const MBi = Br * tableBi + Bi * tableBr;\n\n          const tableCr = table[2 * k];\n          const tableCi = inv * table[2 * k + 1];\n          const MCr = Cr * tableCr - Ci * tableCi;\n          const MCi = Cr * tableCi + Ci * tableCr;\n\n          const tableDr = table[3 * k];\n          const tableDi = inv * table[3 * k + 1];\n          const MDr = Dr * tableDr - Di * tableDi;\n          const MDi = Dr * tableDi + Di * tableDr;\n\n          // Pre-Final values\n          const T0r = MAr + MCr;\n          const T0i = MAi + MCi;\n          const T1r = MAr - MCr;\n          const T1i = MAi - MCi;\n          const T2r = MBr + MDr;\n          const T2i = MBi + MDi;\n          const T3r = inv * (MBr - MDr);\n          const T3i = inv * (MBi - MDi);\n\n          // Final values\n          const FAr = T0r + T2r;\n          const FAi = T0i + T2i;\n\n          const FCr = T0r - T2r;\n          const FCi = T0i - T2i;\n\n          const FBr = T1r + T3i;\n          const FBi = T1i - T3r;\n\n          const FDr = T1r - T3i;\n          const FDi = T1i + T3r;\n\n          out[A] = FAr;\n          out[A + 1] = FAi;\n          out[B] = FBr;\n          out[B + 1] = FBi;\n          out[C] = FCr;\n          out[C + 1] = FCi;\n          out[D] = FDr;\n          out[D + 1] = FDi;\n        }\n      }\n    }\n  }\n\n  // radix-2 implementation\n  //\n  // NOTE: Only called for len=4\n  private _singleTransform2(outOff: number, off: number, step: number): void {\n    const out = this._out!;\n    const data = this._data!;\n\n    const evenR = data[off];\n    const evenI = data[off + 1];\n    const oddR = data[off + step];\n    const oddI = data[off + step + 1];\n\n    const leftR = evenR + oddR;\n    const leftI = evenI + oddI;\n    const rightR = evenR - oddR;\n    const rightI = evenI - oddI;\n\n    out[outOff] = leftR;\n    out[outOff + 1] = leftI;\n    out[outOff + 2] = rightR;\n    out[outOff + 3] = rightI;\n  }\n\n  // radix-4\n  //\n  // NOTE: Only called for len=8\n  private _singleTransform4(outOff: number, off: number, step: number): void {\n    const out = this._out!;\n    const data = this._data!;\n    const inv = this._inv ? -1 : 1;\n    const step2 = step * 2;\n    const step3 = step * 3;\n\n    // Original values\n    const Ar = data[off];\n    const Ai = data[off + 1];\n    const Br = data[off + step];\n    const Bi = data[off + step + 1];\n    const Cr = data[off + step2];\n    const Ci = data[off + step2 + 1];\n    const Dr = data[off + step3];\n    const Di = data[off + step3 + 1];\n\n    // Pre-Final values\n    const T0r = Ar + Cr;\n    const T0i = Ai + Ci;\n    const T1r = Ar - Cr;\n    const T1i = Ai - Ci;\n    const T2r = Br + Dr;\n    const T2i = Bi + Di;\n    const T3r = inv * (Br - Dr);\n    const T3i = inv * (Bi - Di);\n\n    // Final values\n    const FAr = T0r + T2r;\n    const FAi = T0i + T2i;\n\n    const FBr = T1r + T3i;\n    const FBi = T1i - T3r;\n\n    const FCr = T0r - T2r;\n    const FCi = T0i - T2i;\n\n    const FDr = T1r - T3i;\n    const FDi = T1i + T3r;\n\n    out[outOff] = FAr;\n    out[outOff + 1] = FAi;\n    out[outOff + 2] = FBr;\n    out[outOff + 3] = FBi;\n    out[outOff + 4] = FCr;\n    out[outOff + 5] = FCi;\n    out[outOff + 6] = FDr;\n    out[outOff + 7] = FDi;\n  }\n\n  // Real input radix-4 implementation\n  private _realTransform4(): void {\n    const out = this._out!;\n    const size = this._csize;\n\n    // Initial step (permute and transform)\n    const width = this._width;\n    let step = 1 << width;\n    let len = (size / step) << 1;\n\n    let outOff: number;\n    let t: number;\n    const bitrev = this._bitrev;\n    if (len === 4) {\n      for (outOff = 0, t = 0; outOff < size; outOff += len, t++) {\n        const off = bitrev[t];\n        this._singleRealTransform2(outOff, off >>> 1, step >>> 1);\n      }\n    } else {\n      // len === 8\n      for (outOff = 0, t = 0; outOff < size; outOff += len, t++) {\n        const off = bitrev[t];\n        this._singleRealTransform4(outOff, off >>> 1, step >>> 1);\n      }\n    }\n\n    // Loop through steps in decreasing order\n    const inv = this._inv ? -1 : 1;\n    const table = this.table;\n    for (step >>= 2; step >= 2; step >>= 2) {\n      len = (size / step) << 1;\n      const halfLen = len >>> 1;\n      const quarterLen = halfLen >>> 1;\n      const hquarterLen = quarterLen >>> 1;\n\n      // Loop through offsets in the data\n      for (outOff = 0; outOff < size; outOff += len) {\n        for (let i = 0, k = 0; i <= hquarterLen; i += 2, k += step) {\n          const A = outOff + i;\n          const B = A + quarterLen;\n          const C = B + quarterLen;\n          const D = C + quarterLen;\n\n          // Original values\n          const Ar = out[A];\n          const Ai = out[A + 1];\n          const Br = out[B];\n          const Bi = out[B + 1];\n          const Cr = out[C];\n          const Ci = out[C + 1];\n          const Dr = out[D];\n          const Di = out[D + 1];\n\n          // Middle values\n          const MAr = Ar;\n          const MAi = Ai;\n\n          const tableBr = table[k];\n          const tableBi = inv * table[k + 1];\n          const MBr = Br * tableBr - Bi * tableBi;\n          const MBi = Br * tableBi + Bi * tableBr;\n\n          const tableCr = table[2 * k];\n          const tableCi = inv * table[2 * k + 1];\n          const MCr = Cr * tableCr - Ci * tableCi;\n          const MCi = Cr * tableCi + Ci * tableCr;\n\n          const tableDr = table[3 * k];\n          const tableDi = inv * table[3 * k + 1];\n          const MDr = Dr * tableDr - Di * tableDi;\n          const MDi = Dr * tableDi + Di * tableDr;\n\n          // Pre-Final values\n          const T0r = MAr + MCr;\n          const T0i = MAi + MCi;\n          const T1r = MAr - MCr;\n          const T1i = MAi - MCi;\n          const T2r = MBr + MDr;\n          const T2i = MBi + MDi;\n          const T3r = inv * (MBr - MDr);\n          const T3i = inv * (MBi - MDi);\n\n          // Final values\n          const FAr = T0r + T2r;\n          const FAi = T0i + T2i;\n\n          const FBr = T1r + T3i;\n          const FBi = T1i - T3r;\n\n          out[A] = FAr;\n          out[A + 1] = FAi;\n          out[B] = FBr;\n          out[B + 1] = FBi;\n\n          // Output final middle point\n          if (i === 0) {\n            const FCr = T0r - T2r;\n            const FCi = T0i - T2i;\n            out[C] = FCr;\n            out[C + 1] = FCi;\n            continue;\n          }\n\n          // Do not overwrite ourselves\n          if (i === hquarterLen)\n            continue;\n\n          // In the flipped case:\n          // MAi = -MAi\n          // MBr=-MBi, MBi=-MBr\n          // MCr=-MCr\n          // MDr=MDi, MDi=MDr\n          const ST0r = T1r;\n          const ST0i = -T1i;\n          const ST1r = T0r;\n          const ST1i = -T0i;\n          const ST2r = -inv * T3i;\n          const ST2i = -inv * T3r;\n          const ST3r = -inv * T2i;\n          const ST3i = -inv * T2r;\n\n          const SFAr = ST0r + ST2r;\n          const SFAi = ST0i + ST2i;\n\n          const SFBr = ST1r + ST3i;\n          const SFBi = ST1i - ST3r;\n\n          const SA = outOff + quarterLen - i;\n          const SB = outOff + halfLen - i;\n\n          out[SA] = SFAr;\n          out[SA + 1] = SFAi;\n          out[SB] = SFBr;\n          out[SB + 1] = SFBi;\n        }\n      }\n    }\n  }\n\n  // radix-2 implementation\n  //\n  // NOTE: Only called for len=4\n  private _singleRealTransform2(outOff: number, off: number, step: number): void {\n    const out = this._out!;\n    const data = this._data!;\n\n    const evenR = data[off];\n    const oddR = data[off + step];\n\n    const leftR = evenR + oddR;\n    const rightR = evenR - oddR;\n\n    out[outOff] = leftR;\n    out[outOff + 1] = 0;\n    out[outOff + 2] = rightR;\n    out[outOff + 3] = 0;\n  }\n\n  // radix-4\n  //\n  // NOTE: Only called for len=8\n  private _singleRealTransform4(outOff: number, off: number, step: number): void {\n    const out = this._out!;\n    const data = this._data!;\n    const inv = this._inv ? -1 : 1;\n    const step2 = step * 2;\n    const step3 = step * 3;\n\n    // Original values\n    const Ar = data[off];\n    const Br = data[off + step];\n    const Cr = data[off + step2];\n    const Dr = data[off + step3];\n\n    // Pre-Final values\n    const T0r = Ar + Cr;\n    const T1r = Ar - Cr;\n    const T2r = Br + Dr;\n    const T3r = inv * (Br - Dr);\n\n    // Final values\n    const FAr = T0r + T2r;\n\n    const FBr = T1r;\n    const FBi = -T3r;\n\n    const FCr = T0r - T2r;\n\n    const FDr = T1r;\n    const FDi = T3r;\n\n    out[outOff] = FAr;\n    out[outOff + 1] = 0;\n    out[outOff + 2] = FBr;\n    out[outOff + 3] = FBi;\n    out[outOff + 4] = FCr;\n    out[outOff + 5] = 0;\n    out[outOff + 6] = FDr;\n    out[outOff + 7] = FDi;\n  }\n}\n","import { average, closest, logspace, linspace } from './math';\n\nconsole.debug(\"Fractional Octave Smoothing module loaded\");\n\nexport function getFractionalOctaveFrequencies(fraction: number, f_low: number = 20, f_high: number = 24000, fftSize: number): Float32Array {\n    if (fraction <= 0) {\n        throw new Error(\"Fraction must be greater than 0\");\n    }\n    if (f_low <= 0 || f_high <= 0) {\n        throw new Error(\"Frequencies must be greater than 0\");\n    }\n    if (f_low >= f_high) {\n        throw new Error(\"f_low must be less than f_high\");\n    }\n    const num_points = Math.round((Math.log10(f_high) - Math.log10(f_low)) / fraction) + 1;\n\n    let frequencies = logspace(f_low, f_high, num_points);\n\n    const frequency_resolution = 48000 / fftSize; // Assuming a sample rate of 48000 Hz\n\n    for (let i = 0; i < frequencies.length; i++) {\n        frequencies[i] = Math.round(frequencies[i] / frequency_resolution) * frequency_resolution;\n    }\n    frequencies = Float32Array.from(new Set(frequencies)); // Remove duplicates\n\n    return frequencies;\n}\n\nexport function fractionalOctaveSmoothing(frequencyData: Float32Array, fraction: number, frequencies: Float32Array): Float32Array{\n    const FD = frequencyData;\n    const F = frequencies;\n    const n = FD.length | 0;\n    const out = new Float32Array(F.length);\n    if (n === 0 || F.length === 0) return out;\n\n    const nMinus1 = n - 1;\n    const half = n * 0.5;\n    const fac = Math.pow(2, 0.5 * fraction) - Math.pow(2, -0.5 * fraction);\n    const invBin = n > 1 ? (nMinus1) / 24000 : 0;\n\n    // prefix sum (double precision for accumulation)\n    const pref = new Float64Array(n + 1);\n    for (let k = 0; k < n; ++k) pref[k + 1] = pref[k] + FD[k];\n\n    for (let p = 0, P = F.length; p < P; ++p) {\n        // map center frequency to nearest bin index\n        const fp = F[p];\n        let i = invBin ? ((fp * invBin) + 0.5) | 0 : 0;\n        if (i < 0) i = 0;\n        else if (i > nMinus1) i = nMinus1;\n\n        // compute window half-width in bins (integer)\n        const dist = Math.abs(half - i);\n        let w = ((0.5 * fac * (half - dist)) + 0.5) | 0;\n\n        if (w <= 0) {\n            out[p] = FD[i];\n            continue;\n        }\n\n        // inclusive start/end indices\n        let s = i - w + 1;\n        if (s < 0) s = 0;\n        let e = i + w;\n        if (e > nMinus1) e = nMinus1;\n\n        const len = e - s + 1;\n        if (len <= 0) {\n            out[p] = FD[i];\n        } else {\n            const sum = pref[e + 1] - pref[s];\n            out[p] = sum / len;\n        }\n    }\n    return out;\n}\n","import { abs, average, closest, linspace, mod, nextPow2 } from './math';\nimport { FFT } from './fft';\nimport { fractionalOctaveSmoothing, getFractionalOctaveFrequencies } from './fractional_octave_smoothing';\nimport { read } from './wave';\n\nconsole.debug(\"Audio module loaded\");\n\n(window as any).FFT = FFT; // Make FFT globally available\n\nexport function sum(buffer: Float32Array): number {\n    let sum = 0;\n    for (let i = 0; i < buffer.length; i++) {\n        sum += buffer[i] * buffer[i];\n    }\n    return sum\n}\n\nexport function rms(buffer: Float32Array): number {\n    // Assuming mono channel for simplicity; extend as needed for multi-channel\n    return Math.sqrt(sum(buffer) / buffer.length);\n}\n\nexport function normalize(input: Float32Array, peak: boolean = false): Float32Array {\n    const rms_value = rms(input);\n    if (rms_value === 0) return input; // avoid division by zero, return original (silence)\n\n    const factor = (1 / rms_value) * (peak ? 1 : Math.SQRT2);\n\n    return input.map(v => v * factor);\n}\n\nexport function db(value: Float32Array): Float32Array;\nexport function db(value: number): number;\nexport function db(value: Float32Array | number): Float32Array | number {\n    if (value instanceof Float32Array) {\n        return value.map(v => 20 * Math.log10(v + 1e-50));\n    } else {\n        return 20 * Math.log10(value + 1e-50);\n    }\n}\n\nexport function exponentialMovingAverage(old: number, value: number, alpha: number): number {\n    return alpha * value + (1 - alpha) * old;\n}\n\nexport const smoothingFactor = (timeConstant: number, sampleRate: number): number => {\n    return 1 - Math.exp(-1 / (sampleRate * timeConstant));\n}\n\nexport function dbToLinear(value: Float32Array): Float32Array;\nexport function dbToLinear(value: number): number;\nexport function dbToLinear(value: Float32Array | number): Float32Array | number {\n    if (value instanceof Float32Array) {\n        return value.map(v => Math.pow(10, v / 20));\n    } else {\n        return Math.pow(10, value / 20);\n    }\n}\n\nexport function getExponentialSmoothingFactor(timeConstant: number, sampleRate: number): number {\n    return 1 - Math.exp(-1 / (timeConstant * sampleRate));\n}\n\nexport interface FFTResult {\n    frequency: Float32Array;\n    magnitude: Float32Array;\n    phase: Float32Array;\n    fftSize: number;\n    peakAt?: number;\n    sampleRate?: number;\n}\n\nasync function loadAudioFile(file: File): Promise<Audio> {\n    const headerBuffer = await file.slice(0, 256 * 1024).arrayBuffer();\n\n    function getExt(name: string) {\n        const ext = (name.split('.').pop() || '').toLowerCase();\n\n        return ext;\n    }\n\n    function getMimeType(ext: string) {\n        const mimeTypes: { [key: string]: string } = {\n            'wav': 'audio/wav',\n            'mp3': 'audio/mpeg',\n            'flac': 'audio/flac',\n            'ogg': 'audio/ogg',\n            'm4a': 'audio/mp4',\n        };\n        return mimeTypes[ext] || 'application/octet-stream';\n    }\n\n    function getNameWithoutExt(name: string) {\n        const parts = name.split('.');\n        if (parts.length > 1) {\n            parts.pop();\n            return parts.join('.');\n        }\n        return name;\n    }\n\n    function parseWav(buf: ArrayBuffer) {\n        const dv = new DataView(buf);\n        function readStr(off: number, len: number) {\n            let s = '';\n            for (let i = 0; i < len; i++) s += String.fromCharCode(dv.getUint8(off + i));\n            return s;\n        }\n\n        if (readStr(0, 4) !== 'RIFF' || readStr(8, 4) !== 'WAVE') return null;\n\n        let offset = 12;\n        const info: any = {};\n        while (offset + 8 <= dv.byteLength) {\n            const id = readStr(offset, 4);\n            const size = dv.getUint32(offset + 4, true);\n            if (id === 'fmt ') {\n                info.audioFormat = dv.getUint16(offset + 8, true);\n                info.numChannels = dv.getUint16(offset + 10, true);\n                info.sampleRate = dv.getUint32(offset + 12, true);\n                info.byteRate = dv.getUint32(offset + 16, true);\n                info.blockAlign = dv.getUint16(offset + 20, true);\n                info.bitsPerSample = dv.getUint16(offset + 22, true);\n            } else if (id === 'data') {\n                info.dataChunkSize = size;\n            }\n            offset += 8 + size + (size % 2);\n        }\n        if (info.sampleRate && info.byteRate && info.dataChunkSize) {\n            info.duration = info.dataChunkSize / info.byteRate;\n        }\n\n        // Attempt to detect and decode embedded iXML chunk from the headerBuffer.\n        try {\n            const dvh = new DataView(headerBuffer);\n            const readStr = (off: number, len: number) => {\n                let s = '';\n                for (let i = 0; i < len; i++) s += String.fromCharCode(dvh.getUint8(off + i));\n                return s;\n            };\n\n            let offset = 12; // Skip RIFF/WAVE header region where chunks start\n            while (offset + 8 <= dvh.byteLength) {\n                const id = readStr(offset, 4);\n                const size = dvh.getUint32(offset + 4, true);\n                if (id === 'iXML') {\n                    const start = offset + 8;\n                    const end = Math.min(start + size, dvh.byteLength);\n                    const xmlBytes = new Uint8Array(headerBuffer.slice(start, end));\n                    const xmlString = new TextDecoder().decode(xmlBytes);\n\n                    // Attach raw iXML to the File object for later use\n                    (file as any).__iXMLraw = xmlString;\n\n                    // Try to convert iXML to an object using available converter:\n                    // prefer convertiXMLtoObject exported by ./wave (if available on imported read)\n                    // or a global window.wave.convertiXMLtoObject if provided by user's environment.\n                    try {\n                        const parser = new DOMParser();\n                        (file as any).__iXML = parser.parseFromString((file as any).__iXMLraw, \"application/xml\");\n                        const userNode = (file as any).__iXML.querySelector(\"USER\");\n                        if (userNode) {\n                            const meta: { [key: string]: string | number | null } = {};\n                            Array.from(userNode.children).forEach((el: any) => {\n                                const key = el.tagName.toLowerCase();\n                                const txt = (el.textContent || '').trim();\n                                const num = Number(txt);\n                                meta[key] = txt === '' ? null : (Number.isFinite(num) ? num : txt);\n                            });\n                            (file as any).metadata = Object.assign((file as any).metadata || {}, meta);\n                        }\n                    } catch (e) {\n                        console.warn('iXML conversion attempt failed:', e);\n                    }\n\n                    break; // stop after first iXML chunk found\n                }\n                offset += 8 + size + (size % 2);\n            }\n        } catch (e) {\n            console.warn('Failed to scan header for iXML chunk:', e);\n        }\n        return info;\n    }\n\n    function parseMp3(buf: ArrayBuffer) {\n        const bytes = new Uint8Array(buf);\n        let offset = 0;\n        // Skip ID3v2 tag if present\n        if (bytes[0] === 0x49 && bytes[1] === 0x44 && bytes[2] === 0x33) {\n            const size = ((bytes[6] & 0x7f) << 21) | ((bytes[7] & 0x7f) << 14) | ((bytes[8] & 0x7f) << 7) | (bytes[9] & 0x7f);\n            offset = 10 + size;\n        }\n        // find first frame header\n        let headerIndex = -1;\n        for (let i = offset; i < bytes.length - 4; i++) {\n            if (bytes[i] === 0xFF && (bytes[i + 1] & 0xE0) === 0xE0) {\n                headerIndex = i;\n                break;\n            }\n        }\n        if (headerIndex < 0) return null;\n        const b1 = bytes[headerIndex + 1];\n        const b2 = bytes[headerIndex + 2];\n        const b3 = bytes[headerIndex + 3];\n\n        const versionBits = (b1 >> 3) & 0x03;\n        const layerBits = (b1 >> 1) & 0x03;\n        const bitrateBits = (b2 >> 4) & 0x0f;\n        const sampleRateBits = (b2 >> 2) & 0x03;\n        const channelMode = (b3 >> 6) & 0x03;\n\n        const versions: any = {\n            0: 'MPEG Version 2.5',\n            1: 'reserved',\n            2: 'MPEG Version 2 (ISO/IEC 13818-3)',\n            3: 'MPEG Version 1 (ISO/IEC 11172-3)'\n        };\n        const layers: any = {\n            0: 'reserved',\n            1: 'Layer III',\n            2: 'Layer II',\n            3: 'Layer I'\n        };\n\n        const sampleRates: any = {\n            3: [44100, 48000, 32000],\n            2: [22050, 24000, 16000],\n            0: [11025, 12000, 8000]\n        };\n        const versionKey = versionBits;\n        const layerKey = layerBits;\n\n        // bitrate tables (kbps)\n        const bitrateTable: any = {\n            // MPEG1 Layer III\n            '3_1': [0, 32, 40, 48, 56, 64, 80, 96, 112, 128, 160, 192, 224, 256, 320, 0],\n            // MPEG2/2.5 Layer III\n            '0_1': [0, 8, 16, 24, 32, 40, 48, 56, 64, 80, 96, 112, 128, 144, 160, 0],\n            '2_1': [0, 8, 16, 24, 32, 40, 48, 56, 64, 80, 96, 112, 128, 144, 160, 0],\n            // fallback generic table for other layers/versions (best-effort)\n            '3_2': [0, 32, 48, 56, 64, 80, 96, 112, 128, 160, 192, 224, 256, 320, 384, 0],\n            '3_3': [0, 32, 64, 96, 128, 160, 192, 224, 256, 320, 384, 448, 512, 576, 640, 0]\n        };\n\n        const versionStr = versions[versionKey] || 'unknown';\n        const layerStr = layers[layerKey] || 'unknown';\n        let sampleRate = sampleRates[versionKey]?.[sampleRateBits] || null;\n\n        let bitrateKbps = 0;\n        const tbKey = `${versionKey}_${layerKey}`;\n        if (bitrateTable[tbKey]) {\n            bitrateKbps = bitrateTable[tbKey][bitrateBits] || 0;\n        } else if (bitrateTable['3_1'] && versionKey === 3 && layerKey === 1) {\n            bitrateKbps = bitrateTable['3_1'][bitrateBits] || 0;\n        }\n\n        const channels = channelMode === 3 ? 1 : 2;\n        let duration = null;\n        if (bitrateKbps > 0) {\n            duration = (bytes.length * 8) / (bitrateKbps * 1000);\n        }\n\n        return {\n            version: versionStr,\n            layer: layerStr,\n            bitrateKbps: bitrateKbps || null,\n            sampleRate,\n            channels,\n            duration\n        };\n    }\n\n    const ext = getExt(file.name);\n    const mime = file.type || 'unknown';\n    let metadata: { [Key: string]: string | number | null } = { ...(file as any).__iXML };\n\n    // Basic file info\n    metadata.filename = file.name;\n    metadata.name = getNameWithoutExt(file.name);\n    metadata.size = file.size;\n    metadata.mime = mime;\n    metadata.ext = ext;\n    metadata.iXML = (file as any).metadata || null;\n\n    const wavInfo = parseWav(headerBuffer);\n    if (wavInfo) {\n        metadata.format = 'wav';\n        metadata = Object.assign(metadata, wavInfo || {});\n    } else if (mime === 'audio/mpeg' || ext === 'mp3') {\n        const mp3Info = parseMp3(headerBuffer);\n        metadata.format = 'mp3';\n        metadata = Object.assign(metadata, mp3Info || {});\n    } else {\n        // best-effort: report file.type and extension and later rely on AudioContext decode\n        metadata.format = mime || ext || 'unknown';\n    }\n\n    console.log('Extracted file metadata:', metadata);\n    const arrayBuffer = await file.arrayBuffer();\n    const audioContext = new (window.AudioContext || (window as any).webkitAudioContext)();\n    const audioBuffer: AudioBuffer = await audioContext.decodeAudioData(arrayBuffer);\n\n    return Audio.fromAudioBuffer(audioBuffer, metadata);\n}\nexport async function loadAudioFromBlob(blob: Blob, filename?: string): Promise<Audio> {\n    const file = blob instanceof File\n        ? blob\n        : new File([blob], filename ?? 'blob', { type: blob.type || '' });\n    return await loadAudioFile(file);\n}\nexport async function loadAudioFromFilename(filename: string): Promise<Audio> {\n    const resp = await fetch(filename);\n    const blob = await resp.blob();\n    console.log(`Fetched audio file from ${filename}:`, blob);\n    return await loadAudioFromBlob(blob, filename);\n}\n\n\n\nexport class Audio extends AudioBuffer {\n    metadata: { [Key: string]: string | number | null; } = {};\n\n    static fromAudioBuffer(buffer: AudioBuffer, metadata: { [Key: string]: string | number | null; }): Audio {\n        const audio = new Audio({\n            length: buffer.length,\n            numberOfChannels: buffer.numberOfChannels,\n            sampleRate: buffer.sampleRate\n        });\n        for (let ch = 0; ch < buffer.numberOfChannels; ch++) {\n            audio.copyToChannel(buffer.getChannelData(ch), ch);\n        }\n        audio.metadata = metadata;\n        console.log('Created Audio from AudioBuffer with metadata:', audio.metadata);\n        return audio;\n    }\n\n    static fromSamples(samples: Float32Array, sampleRate: number = 48000, metadata: { [Key: string]: string | number | null; }): Audio {\n        if (!samples || samples.length == 0) return new Audio({ length: 0, numberOfChannels: 1, sampleRate: sampleRate });\n        const audio = new Audio({\n            length: samples.length,\n            numberOfChannels: 1,\n            sampleRate: sampleRate\n        });\n        audio.copyToChannel(samples, 0);\n        audio.metadata = metadata;\n        return audio;\n    }\n\n    static fromObject(obj: any): Audio {\n        const sampleRate = obj.sampleRate || 48000;\n        const numberOfChannels = obj.numberOfChannels || 1;\n        const length = obj.length || (obj.data ? obj.data.length / numberOfChannels : 1);\n        const audio = new Audio({\n            length: length,\n            numberOfChannels: numberOfChannels,\n            sampleRate: sampleRate,\n        });\n\n        if (obj.data) {\n            for (let i = 0; i < numberOfChannels; i++) {\n                audio.copyToChannel(\n                    Float32Array.from(Object.values(obj.data)).slice(i * length, (i + 1) * length), i, 0);\n            }\n        }\n        console.log('Created Audio from object:', audio.getChannelData(0));\n\n        obj.metadata = obj.metadata || {};\n        audio.metadata = obj.metadata;\n\n        return audio;\n    }\n\n    toObject(): { [Key: string]: any; } {\n        const obj = {\n            sampleRate: this.sampleRate,\n            numberOfChannels: this.numberOfChannels,\n            length: this.length,\n            metadata: this.metadata,\n            data: Float32Array.from({ length: this.length * this.numberOfChannels }, (_, i) => {\n                const channel = Math.floor(i / this.length);\n                const index = i % this.length;\n                return this.getChannelData(channel)[index];\n            })\n        };\n        console.log(obj);\n        return obj;\n    }\n\n    applyGain(gain: number): Audio {\n        const numChannels = this.numberOfChannels;\n        for (let ch = 0; ch < numChannels; ch++) {\n            const data = this.getChannelData(ch).map(v => v * gain);\n            this.copyToChannel(data, ch, 0);\n        }\n        return this;\n    }\n\n    getChannel(channel: number): Audio {\n        if (channel < 0 || channel >= this.numberOfChannels) {\n            throw new Error(\"Invalid channel number\");\n        }\n        const channelData = this.getChannelData(channel);\n        const newBuffer = new AudioBuffer({\n            length: channelData.length,\n            numberOfChannels: 1,\n            sampleRate: this.sampleRate\n        });\n        // copy channel samples into the mono buffer\n        newBuffer.copyToChannel(channelData, 0, 0);\n        return new Audio(newBuffer);\n    }\n\n    rms(channel: number = 0): number {\n        if (channel < 0 || channel >= this.numberOfChannels) {\n            throw new Error(\"Invalid channel number\");\n        }\n        const data = this.getChannelData(channel);\n        return rms(data);\n    }\n\n    getEnvelopeImage(channel: number = 0, width: number = 300, height: number = 100): string {\n        if (channel < 0 || channel >= this.numberOfChannels) {\n            throw new Error(\"Invalid channel number\");\n        }\n        const data = this.getChannelData(channel);\n        const canvas = document.createElement('canvas');\n        canvas.width = width;\n        canvas.height = height;\n        const ctx = canvas.getContext('2d');\n        if (!ctx) throw new Error(\"Failed to get canvas context\");\n        const imgData = ctx.createImageData(width, height);\n        const samplesPerPixel = Math.max(1, Math.floor(data.length / width));\n        for (let x = 0; x < width; x++) {\n            let min = 1.0;\n            let max = -1.0;\n            for (let i = 0; i < samplesPerPixel; i++) {\n                const sampleIndex = x * samplesPerPixel + i;\n                if (sampleIndex >= data.length) break;\n                const sample = data[sampleIndex];\n                if (sample < min) min = sample;\n                if (sample > max) max = sample;\n            }\n            const yMin = Math.floor((1 - (min + 1) / 2) * height);\n            const yMax = Math.floor((1 - (max + 1) / 2) * height);\n            for (let y = 0; y < height; y++) {\n                const index = (y * width + x) * 4;\n                if (y >= yMax && y <= yMin) {\n                    imgData.data[index] = 0;\n                    imgData.data[index + 1] = 0;\n                    imgData.data[index + 2] = 0;\n                    imgData.data[index + 3] = 20;\n                } else {\n                    imgData.data[index] = 255;\n                    imgData.data[index + 1] = 255;\n                    imgData.data[index + 2] = 255;\n                    imgData.data[index + 3] = 0;\n                }\n            }\n        }\n        ctx.putImageData(imgData, 0, 0);\n        return canvas.toDataURL(\"image/png\");\n\n    }\n\n    static async fromFilename(filename: string): Promise<Audio> {\n        const response = await fetch(filename);\n        const file = await response.blob();\n        return await loadAudioFile(file as File);\n    }\n}\n\nexport function chirp(f_start: number, f_stop: number, duration: number | null = null, rate: number | null = null, fade: number = 0.01, fs: number = 48000): [Float32Array, Float32Array, Float32Array] {\n    const c = Math.log(f_stop / f_start);\n\n    let L: number;\n    let samples_count: number;\n\n    if (duration == null && rate == null) {\n        // Default to one decade per second if nothing provided\n        rate = 1.0;\n    }\n\n    if (duration == null) {\n        // rate is seconds per decade -> L = rate / ln(10)\n        L = (rate as number) / Math.log(10);\n        samples_count = Math.round(L * c * fs);\n        duration = samples_count / fs;\n    } else {\n        L = duration / c;\n        rate = Math.log(10) * L;\n        samples_count = Math.round(L * c * fs);\n    }\n\n    samples_count = Math.max(1, samples_count);\n\n    const fade_in = Math.max(0, Math.floor(fade * fs));\n    const fade_out = Math.max(0, Math.floor((fade / 10) * fs));\n\n    // instantaneous phase\n    // phi = (L * f_start) * (exp(t/L) - 1)\n    // compact phi: pre-fade (fade_in samples), main sweep, post-fade (fade_out samples)\n    const pre = Math.max(0, fade_in);\n    const post = Math.max(0, fade_out);\n    const phi = Float32Array.from({ length: pre + samples_count + post }, () => 0);\n\n    // offset matches original phi_fade_in last value: f_start * ((fade_in+1)/fs)\n    const offset = f_start * ((fade_in + 1) / fs);\n\n    // pre-fade linear ramp\n    for (let i = 0; i < pre; i++) phi[i] = f_start * (i / fs);\n\n    // main sweep (adds offset)\n    const baseIdx = pre;\n    for (let i = 0; i < samples_count; i++) {\n        let t = i / fs;\n        phi[baseIdx + i] = L * f_start * (Math.exp(t / L) - 1) + offset;\n    }\n\n    // post-fade linear ramp starting from last sweep value\n    const last = phi[baseIdx + samples_count - 1] || 0;\n    for (let i = 0; i < post; i++) {\n        phi[baseIdx + samples_count + i] = last + f_stop * ((i + 1) / fs);\n    }\n\n    // sweep = sin(2 * PI * phi)\n    const sweep = Float32Array.from({ length: phi.length }, () => 0);\n    for (let i = 0; i < phi.length; i++) sweep[i] = Math.sin(2 * Math.PI * phi[i]);\n\n    // compute time vector t for sweep length\n    const t = Float32Array.from({ length: sweep.length }, () => 0);\n    for (let i = 0; i < sweep.length; i++) t[i] = i / fs;\n\n    // envelope main: (exp(-t/L) / L) * f_stop * duration^2\n    const envMain = Float32Array.from({ length: t.length }, () => 0);\n    const factor = f_stop * (duration as number) * (duration as number);\n    for (let i = 0; i < t.length; i++) envMain[i] = (Math.exp(-t[i] / L) / L) * factor;\n\n    // prepend and append small zero pads (approx. 10ms and 1ms at given fs)\n    const startZeros = Math.floor(0.01 * fs); // ~480 samples at 48k\n    const endZeros = Math.floor(0.001 * fs);  // ~48 samples at 48k\n    const envelope = Float32Array.from({ length: startZeros + envMain.length + endZeros }, () => 0);\n    // copy envMain into middle\n    for (let i = 0; i < envMain.length; i++) {\n        envelope[startZeros + i] = envMain[i];\n    }\n\n    // window: simple linear fade in/out over fade_in / fade_out samples\n    const window = Float32Array.from({ length: sweep.length }, () => 0);\n    for (let i = 0; i < sweep.length; i++) {\n        let w = 1.0;\n        if (fade_in > 0 && i < fade_in) {\n            w = i / Math.max(1, fade_in);\n        }\n        if (fade_out > 0 && i >= sweep.length - fade_out) {\n            const k = i - (sweep.length - fade_out);\n            w *= 1 - (k / Math.max(1, fade_out));\n        }\n        window[i] = w;\n    }\n\n    // apply window to sweep\n    const sweepWindowed = Float32Array.from({ length: sweep.length }, () => 0);\n    for (let i = 0; i < sweep.length; i++) sweepWindowed[i] = sweep[i] * window[i];\n\n    return [sweepWindowed, t, envelope];\n}\n\nexport function smoothFFT(fftData: FFTResult, fraction: number, resolution: number): FFTResult {\n    const { frequency, magnitude, phase, fftSize } = fftData;\n    const smoothedMagnitude = Float32Array.from({ length: magnitude.length }, () => 0);\n\n    // Get fractional octave frequencies\n    const fractionalFrequencies = getFractionalOctaveFrequencies(resolution, 20, 24000, fftSize);\n\n    // Apply fractional octave smoothing\n    const smoothed = dbToLinear(fractionalOctaveSmoothing(db(magnitude), fraction, fractionalFrequencies));\n    const smoothedPhase = fractionalOctaveSmoothing(phase, fraction, fractionalFrequencies);\n\n    return {\n        frequency: fractionalFrequencies,\n        magnitude: smoothed,\n        phase: smoothedPhase,\n        fftSize\n    };\n}\n\nexport function computeFFT(data: Float32Array | Float32Array, fftSize: number | null = null): FFTResult {\n    fftSize ??= 2 ** Math.ceil(Math.log2(data.length));\n    console.log(`Computing FFT with ${fftSize} bins for data length ${data.length}`);\n    const fft = new FFT(fftSize);\n    const out = fft.createComplexArray();\n\n    // Fix data length by zero-padding or truncating.\n    const frame = Float32Array.from({ length: fftSize }, () => 0);\n    for (let i = 0; i < fftSize; i++) {\n        frame[i] = (data[i] || 0) * 1;\n    }\n    fft.realTransform(out, frame);\n\n    const frequency = Float32Array.from({ length: fftSize / 2 }, () => 0);\n    const magnitude = Float32Array.from({ length: fftSize / 2 }, () => 0);\n    const phase = Float32Array.from({ length: fftSize / 2 }, () => 0);\n\n    for (let i = 0; i < fftSize / 2; i++) {\n        const re = out[2 * i];\n        const im = out[2 * i + 1];\n        magnitude[i] = abs(re, im) * Math.SQRT2; // Scale by sqrt(2) for single-sided spectrum.\n        phase[i] = Math.atan2(im, re); // phase in radians, range [-PI, PI].\n    }\n    const frequencyResolution = 48000 / fftSize; // Assuming sample rate of 48000 Hz\n    for (let i = 0; i < fftSize / 2; i++) {\n        frequency[i] = i * frequencyResolution;\n    }\n\n    return {\n        frequency,\n        magnitude,\n        phase,\n        fftSize,\n    };\n}\n\nexport interface CorrelationResult {\n    corr: Float64Array;\n    lags: Int32Array;\n    estimatedLagSamples: number;\n    estimatedLagIndex: number;\n    peakCorrelation: number;\n    raw: Float64Array;\n    nfft: number;\n}\n\nexport function fftCorrelation(x: Float32Array | Float32Array, y: Float32Array | Float32Array): CorrelationResult {\n    // cross-correlate x with y using FFT (fft.js). Returns normalized cross-correlation,\n    // lags (samples), estimated lag (samples) and peak correlation value.\n    const lenX = x.length;\n    const lenY = y.length;\n    const fullLen = lenX + lenY - 1;\n\n    // next pow2 >= fullLen\n    const nextPow2 = (v: number): number => {\n        let p = 1;\n        while (p < v) p <<= 1;\n        return p;\n    };\n    const n = nextPow2(fullLen);\n\n    // zero-pad inputs to length n\n    const xP = Float32Array.from({ length: n }, () => 0);\n    const yP = Float32Array.from({ length: n }, () => 0);\n    xP.set(x, 0);\n    yP.set(y, 0);\n\n    const fft = new FFT(n);\n    const A = fft.createComplexArray();\n    const B = fft.createComplexArray();\n\n    // forward real FFTs\n    fft.realTransform(A, xP);\n    fft.realTransform(B, yP);\n    // complete the spectrum to full complex arrays (negative freqs)\n    if (typeof fft.completeSpectrum === 'function') {\n        fft.completeSpectrum(A);\n        fft.completeSpectrum(B);\n    }\n\n    // multiply A * conj(B) -> cross-spectrum\n    const C = fft.createComplexArray();\n    for (let k = 0; k < n; k++) {\n        const ar = A[2 * k], ai = A[2 * k + 1];\n        const br = B[2 * k], bi = B[2 * k + 1];\n        // A * conj(B) = (ar + i ai)*(br - i bi)\n        C[2 * k] = ar * br + ai * bi;\n        C[2 * k + 1] = ai * br - ar * bi;\n    }\n\n    // inverse FFT of cross-spectrum\n    const out = fft.createComplexArray();\n    fft.inverseTransform(out, C);\n\n    // real part / n gives linear cross-correlation (no circular wrap because padded)\n    const corr = Float64Array.from({ length: fullLen }, () => 0);\n    for (let i = 0; i < fullLen; i++) {\n        corr[i] = out[2 * i] / n;\n    }\n\n    // compute normalization factor (energy)\n    let sumX2 = 0, sumY2 = 0;\n    for (let i = 0; i < lenX; i++) sumX2 += x[i] * x[i];\n    for (let i = 0; i < lenY; i++) sumY2 += y[i] * y[i];\n    const denom = Math.sqrt(sumX2 * sumY2);\n\n    const normalized = Float64Array.from({ length: fullLen }, () => 0);\n    if (denom > 0) {\n        for (let i = 0; i < fullLen; i++) normalized[i] = corr[i] / denom;\n    } else {\n        // silence case -> zeros\n        for (let i = 0; i < fullLen; i++) normalized[i] = 0;\n    }\n\n    // lags: index i corresponds to lag = i - (lenY - 1)\n    const lags = new Int32Array(fullLen);\n    for (let i = 0; i < fullLen; i++) lags[i] = i - (lenY - 1);\n\n    // find peak\n    let peakIdx = 0;\n    let peakVal = -Infinity;\n    for (let i = 0; i < fullLen; i++) {\n        if (normalized[i] > peakVal) {\n            peakVal = normalized[i];\n            peakIdx = i;\n        }\n    }\n    const estimatedLag = lags[peakIdx];\n\n    return {\n        corr: normalized,\n        lags,\n        estimatedLagSamples: estimatedLag,\n        estimatedLagIndex: peakIdx,\n        peakCorrelation: peakVal,\n        raw: corr,\n        nfft: n\n    };\n}\n\nexport function fftConvolve(x: Float32Array, y: Float32Array, mode: 'same' | 'full'): Float32Array;\nexport function fftConvolve(x: Float64Array, y: Float64Array, mode: 'same' | 'full'): Float64Array;\nexport function fftConvolve(x: Float32Array | Float64Array, y: Float32Array | Float64Array, mode: 'same' | 'full' = 'same'): Float32Array | Float64Array {\n    const lenX = x.length;\n    const lenY = y.length;\n    const fullLen = lenX + lenY - 1;\n\n    // next pow2 >= fullLen\n    const n = nextPow2(fullLen);\n\n    // zero-pad inputs to length n\n    const xP = Float32Array.from({ length: n }, () => 0);\n    const yP = Float32Array.from({ length: n }, () => 0);\n    xP.set(x, 0);\n    yP.set(y, 0);\n\n    const fft = new FFT(n);\n    const A = fft.createComplexArray();\n    const B = fft.createComplexArray();\n\n    // forward real FFTs\n    fft.realTransform(A, xP);\n    fft.realTransform(B, yP);\n    // complete the spectrum to full complex arrays (negative freqs)\n    if (typeof fft.completeSpectrum === 'function') {\n        fft.completeSpectrum(A);\n        fft.completeSpectrum(B);\n    }\n\n    // multiply A * B -> convolution spectrum\n    const C = fft.createComplexArray();\n    for (let k = 0; k < n; k++) {\n        const ar = A[2 * k], ai = A[2 * k + 1];\n        const br = B[2 * k], bi = B[2 * k + 1];\n        C[2 * k] = ar * br - ai * bi;\n        C[2 * k + 1] = ai * br + ar * bi;\n    }\n\n    // inverse FFT\n    const out = fft.createComplexArray();\n    fft.inverseTransform(out, C);\n\n    // extract real part and normalize by n\n    const result = Float32Array.from({ length: fullLen }, () => 0);\n    for (let i = 0; i < fullLen; i++) {\n        result[i] = out[2 * i];\n    }\n\n    // return 'same' mode (centered, matching first input length)\n    if (mode === 'same') {\n        const start = Math.floor((fullLen - lenX) / 2);\n        return result.slice(start, start + lenX);\n    }\n\n    return result;\n}\n\nexport interface ImpulseResponseResult {\n    ir: Float32Array;\n    ir_complex: Float32Array;\n    t: Float32Array;\n    peakAt: number;\n    sampleRate: number;\n    fftSize: number;\n}\n\n\nexport function twoChannelImpulseResponse(y: Float32Array, x: Float32Array): ImpulseResponseResult {\n    // Calculate the impulse response by taking the IFFT of the division of the FFTs of output and input signals.\n    const fullLen = y.length + x.length - 1;\n\n    const N = nextPow2(fullLen);\n\n    // zero-pad inputs to length n\n    const xP = Float32Array.from({ length: N }, () => 0);\n    const yP = Float32Array.from({ length: N }, () => 0);\n    xP.set(y, 0);\n    yP.set(x, 0);\n\n    const fft = new FFT(N);\n    const A = fft.createComplexArray();\n    const B = fft.createComplexArray();\n\n    // forward real FFTs\n    fft.realTransform(A, xP);\n    fft.realTransform(B, yP);\n\n    // Division A / B with regularization to avoid division by zero\n    const C = fft.createComplexArray();\n    const epsilon = 1e-20;\n    for (let k = 0; k < N; k++) {\n        const ar = A[2 * k], ai = A[2 * k + 1];\n        const br = B[2 * k], bi = B[2 * k + 1];\n        const denom = br * br + bi * bi + epsilon;\n        C[2 * k] = (ar * br + ai * bi) / denom;\n        C[2 * k + 1] = (ai * br - ar * bi) / denom;\n    }\n\n    // inverse FFT of cross-spectrum\n    const out = Float32Array.from(fft.createComplexArray());\n    fft.inverseTransform(out, C);\n\n    // Real part / N gives impulse response. This is shifted by N/2.\n    const ir = Float32Array.from({ length: N }, () => 0);\n    for (let i = 0; i < N; i++) {\n        ir[i] = out[2 * ((i + N / 2) % N)]; // normalize by input length\n    }\n\n    const peakAt = closest(100000000, ir) + (-N) / 2;\n    const ir_complex = out.slice(); // copy\n    for (let i = 0; i < N; i++) {\n        ir_complex[2 * i] = out[2 * mod(i + peakAt, N)];\n        ir_complex[2 * i + 1] = out[2 * mod(i + peakAt, N) + 1];\n    }\n\n    // Remove DC offset.\n    const mean = average(ir)\n    for (let i = 0; i < N; i++) {\n        ir[i] = ir[i] - mean;\n    }\n\n    return {\n        ir,\n        ir_complex,\n        t: linspace((-N - 1) / 2 / 48000, (N - 1) / 2 / 48000, N), // assuming 48kHz\n        peakAt,\n        sampleRate: 48000,\n        fftSize: N,\n    };\n}\n\nexport function updatedFFT(dataArray: Float32Array | Float32Array, fftSize: number): FFTResult {\n    dataArray = dataArray as Float32Array;\n\n    fftSize = nextPow2(fftSize);\n\n    // allocate zeroed buffer and copy using built-in set (faster than per-element loops)\n    const dataPadded = new Float32Array(fftSize);\n    const dataLen = Math.min(dataArray.length, fftSize);\n    if (dataLen > 0) dataPadded.set(dataArray.subarray(0, dataLen), 0);\n\n    // perform FFT directly (avoid double-wrapping via computeFFT)\n    const fft = new FFT(fftSize);\n    const B = fft.createComplexArray();\n\n    fft.realTransform(B, dataPadded);\n\n    if (typeof fft.completeSpectrum === 'function') {\n        fft.completeSpectrum(B);\n    }\n\n    const half = fftSize >> 1;\n    const sigMag = new Float32Array(half);\n    const sigPhase = new Float32Array(half);\n\n    // compute magnitude & phase\n    for (let i = 0; i < half; i++) {\n        const br = B[2 * i], bi = B[2 * i + 1];\n        sigMag[i] = abs(br, bi);\n        sigPhase[i] = Math.atan2(bi, br);\n    }\n\n    const frequency = linspace(0, 48000 / 2, half);\n\n    return {\n        frequency,\n        magnitude: sigMag,\n        phase: sigPhase,\n        fftSize\n    };\n}\n\nexport function twoChannelFFT(dataArray: Float32Array | Float32Array, reference: Float32Array | Float32Array, fftSize: number, offset: number, precomputedReference?: FFTResult): FFTResult {\n    const refArr = reference as Float32Array;\n    const dataArr = dataArray as Float32Array;\n\n    // allocate zeroed buffers and copy using built-in set (faster than per-element loops)\n    const dataPadded = new Float32Array(fftSize);\n    const referencePadded = new Float32Array(fftSize);\n\n    if (offset >= 0) {\n        const refLen = Math.min(refArr.length, Math.max(0, fftSize - offset));\n        if (refLen > 0) referencePadded.set(refArr.subarray(0, refLen), offset);\n        const dataLen = Math.min(dataArr.length, fftSize);\n        if (dataLen > 0) dataPadded.set(dataArr.subarray(0, dataLen), 0);\n    } else {\n        const refLen = Math.min(refArr.length, fftSize);\n        if (refLen > 0) referencePadded.set(refArr.subarray(0, refLen), 0);\n        const start = -offset;\n        const dataLen = Math.min(dataArr.length, Math.max(0, fftSize - start));\n        if (dataLen > 0) dataPadded.set(dataArr.subarray(0, dataLen), start);\n    }\n\n    // compute FFTs\n    const sigFFT = updatedFFT(dataPadded, fftSize);\n    const refFFT = precomputedReference || updatedFFT(referencePadded, fftSize);\n\n    const half = fftSize >> 1;\n    const sigMag = sigFFT.magnitude;\n    const sigPhase = sigFFT.phase;\n    const refMag = refFFT.magnitude;\n    const refPhase = refFFT.phase;\n\n    // build transfer magnitude (reference / signal)\n    const h = new Float32Array(half);\n    const phase = new Float32Array(half);\n    for (let i = 0; i < half; i++) {\n        h[i] = sigMag[i] / (refMag[i] || 1e-20);\n        phase[i] = sigPhase[i] - refPhase[i];\n    }\n\n    const frequency = linspace(0, 48000 / 2, half);\n\n    return {\n        frequency,\n        magnitude: h,\n        phase,\n        fftSize\n    };\n}\n\nexport function computeFFTFromIR(ir: ImpulseResponseResult, f_phase_wrap: number = 1000, frequency_multiplier: number = 1): FFTResult {\n    const fftSize = nextPow2(ir.ir.length);\n    const fft = new FFT(fftSize);\n    const out = fft.createComplexArray(); // length 2*fftSize\n\n    // Prepare spectrum into `out`\n    if (ir.ir_complex && ir.ir_complex.length >= 2 && ir.ir_complex[1] === 0) {\n        // real IR -> use realTransform on a zero-padded real frame\n        const frame = new Float32Array(fftSize);\n        frame.set(ir.ir.subarray(0, Math.min(ir.ir.length, fftSize)));\n        fft.realTransform(out, frame);\n    } else {\n        // complex input: ensure input length matches expected complex length\n        if (ir.ir_complex && ir.ir_complex.length === out.length) {\n            fft.transform(out, ir.ir_complex);\n        } else {\n            const tmp = fft.createComplexArray();\n            if (ir.ir_complex) {\n                // Use fast typed-array set if available, otherwise fall back to element-wise copy\n                if (typeof (tmp as any).set === 'function' && (ir.ir_complex as any).subarray) {\n                    (tmp as any).set((ir.ir_complex as any).subarray(0, Math.min(ir.ir_complex.length, tmp.length)));\n                } else {\n                    const len = Math.min(ir.ir_complex.length, tmp.length);\n                    for (let i = 0; i < len; i++) {\n                        tmp[i] = (ir.ir_complex as any)[i];\n                    }\n                }\n            }\n            fft.transform(out, tmp);\n        }\n    }\n\n    const half = fftSize >> 1;\n    const magnitude = new Float32Array(half);\n    const unwrapped = new Float32Array(half);\n\n    // compute magnitude and unwrap phase in one pass\n    if (half > 0) {\n        let prevWrapped = Math.atan2(out[1], out[0]);\n        unwrapped[0] = prevWrapped;\n        magnitude[0] = abs(out[0], out[1]);\n        let offset = 0;\n        for (let i = 1; i < half; i++) {\n            const re = out[2 * i];\n            const im = out[2 * i + 1];\n            const wrapped = Math.atan2(im, re);\n            let delta = wrapped - prevWrapped;\n            if (delta > Math.PI) offset -= 2 * Math.PI;\n            else if (delta < -Math.PI) offset += 2 * Math.PI;\n            const u = wrapped + offset;\n            unwrapped[i] = u;\n            magnitude[i] = abs(re, im);\n            prevWrapped = wrapped;\n        }\n    }\n\n    const frequency = linspace(0, (48000 / 2) * frequency_multiplier, half);\n\n    // normalize phase so that phase at f_phase_wrap is near zero (remove 2pi multiples)\n    const idxNorm = closest(f_phase_wrap, frequency);\n    const normIndex = Math.max(0, Math.min(idxNorm, half - 1));\n    const correction = Math.round(unwrapped[normIndex] / (2 * Math.PI)) * (2 * Math.PI);\n\n    // convert to degrees and apply correction in-place into a phase array\n    const phase = new Float32Array(half);\n    const rad2deg = 180 / Math.PI;\n    for (let i = 0; i < half; i++) {\n        phase[i] = (unwrapped[i] - correction) * rad2deg;\n    }\n\n    return {\n        frequency,\n        magnitude,\n        phase,\n        peakAt: ir.peakAt,\n        sampleRate: ir.sampleRate,\n        fftSize,\n    };\n}\n\nexport function groupDelays(fftData: FFTResult, normalizeAt: number = 1000): Float32Array {\n    const { frequency, phase, peakAt } = fftData;\n    const N = frequency.length;\n    const groupDelay = Float32Array.from({ length: N }, () => 0);\n\n    // Numerical differentiation of unwrapped phase\n    for (let i = 1; i < N - 1; i++) {\n        const dPhase = (phase[i] - phase[i - 1]);\n        const dFreq = (frequency[i] - frequency[i - 1]);\n        groupDelay[i] = -dPhase / dFreq / 360; // in seconds\n    }\n    // Edge cases\n    groupDelay[0] = groupDelay[1];\n    groupDelay[N - 1] = groupDelay[N - 2];\n\n    // Normalize group delay at specified frequency and add delay to make it zero there.\n    const normIdx = closest(normalizeAt, frequency);\n    const delayAtNorm = groupDelay[normIdx];\n    for (let i = 0; i < N; i++) {\n        groupDelay[i] = (groupDelay[i] - delayAtNorm); // assuming 48kHz sample rate, s => ms.\n    }\n\n    return groupDelay;\n}\n\nexport const A_WEIGHTING_COEFFICIENTS: [Float32Array, Float32Array] = [\n    Float32Array.from([0.234301792299513, -0.468603584599026, -0.234301792299513, 0.937207169198054, -0.234301792299515, -0.468603584599025, 0.234301792299513]),\n    Float32Array.from([1.000000000000000, -4.113043408775871, 6.553121752655047, -4.990849294163381, 1.785737302937573, -0.246190595319487, 0.011224250033231]),\n];\n// Coefficients for K-weighting filter (pre-emphasis and high-frequency shelving)\n// From ITU-R BS.1770-4, Table 1\n// https://www.itu.int/dms_pubrec/itu-r/rec/bs/r-rec-bs.1770-2-201103-s!!pdf-e.pdf\nexport const K_WEIGHTING_COEFFICIENTS_PRE: [Float32Array, Float32Array] = [\n    Float32Array.from([1.53512485958697, -2.69169618940638, 1.19839281085285]),\n    Float32Array.from([1, -1.69065929318241, 0.73248077421585])\n];\n\nexport const K_WEIGHTING_COEFFICIENTS_RLB: [Float32Array, Float32Array] = [\n    Float32Array.from([1.0, -2.0, 1.0]),\n    Float32Array.from([1, -1.99004745483398, 0.99007225036621])\n];\n\nexport function applyAWeightingToBuffer(buffer: Float32Array, zi: Float32Array): Float32Array {\n    const b = A_WEIGHTING_COEFFICIENTS[0];\n    const a = A_WEIGHTING_COEFFICIENTS[1];\n    const output = Float32Array.from({ length: buffer.length }, () => 0);\n    for (let n = 0; n < buffer.length; n++) {\n        output[n] = b[0] * buffer[n] + zi[0];\n        for (let i = 1; i < b.length; i++) {\n            zi[i - 1] = b[i] * buffer[n] + zi[i] - a[i] * output[n];\n        }\n    }\n    return output;\n}\n\nexport function gateBuffer(buffer: Float32Array, sampleRate: number, thresholdDb: number = -70, blockMs: number = 400, overlap: number = 0.75): Float32Array {\n    const blockSize = Math.floor((blockMs / 1000) * sampleRate);\n    const hopSize = Math.floor(blockSize * (1 - overlap));\n    const threshold = dbToLinear(thresholdDb);\n\n    const gated = Float32Array.from({ length: buffer.length }, () => 0);\n    let i = 0;\n\n    while (i < buffer.length) {\n        const start = i;\n        const end = Math.min(i + blockSize, buffer.length);\n        const block = buffer.slice(start, end);\n        const blockRms = rms(block);\n\n        if (blockRms >= threshold) {\n            // copy block into gated at position 'start'\n            for (let j = 0; j < block.length; j++) {\n                gated[start + j] = block[j];\n            }\n        }\n        // else: leave zeros (gate closed)\n\n        i += hopSize;\n    }\n\n    return gated;\n}\n\nexport const audio = {\n    loadAudioFile,\n    chirp,\n    computeFFT,\n    smoothFFT,\n    fftCorrelation,\n    fftConvolve,\n    twoChannelImpulseResponse,\n    computeFFTFromIR,\n    twoChannelFFT,\n    groupDelays,\n    applyAWeightingToBuffer,\n    gateBuffer,\n};\n\nexport default audio;","// windows.ts\r\n// Various window functions for signal processing.\r\n\r\nexport type WindowType = 'hanning' | 'hamming' | 'blackman' | 'rectangular' | 'gamma';\r\n\r\nfunction hanningWindow(length: number): Float32Array {\r\n    const window = new Float32Array(length);\r\n    for (let i = 0; i < length; i++) {\r\n        window[i] = 0.5 * (1 - Math.cos(2 * Math.PI * i / (length - 1)));\r\n    }\r\n    return window;\r\n}\r\n\r\nfunction hammingWindow(length: number): Float32Array {\r\n    const window = new Float32Array(length);\r\n    for (let i = 0; i < length; i++) {\r\n        window[i] = 0.54 - 0.46 * Math.cos(2 * Math.PI * i / (length - 1));\r\n    }\r\n    return window;\r\n}\r\n\r\nfunction blackmanWindow(length: number): Float32Array {\r\n    const window = new Float32Array(length);\r\n    for (let i = 0; i < length; i++) {\r\n        window[i] = (0.42 - 0.5 * Math.cos(2 * Math.PI * i / (length - 1)) + 0.08 * Math.cos(4 * Math.PI * i / (length - 1)));\r\n    }\r\n    return window;\r\n}\r\n\r\nfunction equirippleWindow(length: number, attenuation: number = 60): Float32Array {\r\n    // Dolph-Chebyshev window (approximate equiripple)\r\n    // attenuation: sidelobe attenuation in dB\r\n    // Reference: https://en.wikipedia.org/wiki/Chebyshev_window\r\n\r\n    if (length < 2) return new Float32Array([1]);\r\n\r\n    const M = length - 1;\r\n    const tg = Math.cosh(1 / M * Math.acosh(Math.pow(10, attenuation / 20)));\r\n    const window = new Float32Array(length);\r\n\r\n    // Precompute Chebyshev polynomial coefficients\r\n    for (let n = 0; n <= M; n++) {\r\n        let sum = 0;\r\n        for (let k = 0; k <= M; k++) {\r\n            const x = tg * Math.cos(Math.PI * k / M);\r\n            // Chebyshev polynomial of degree M\r\n            let Tm: number;\r\n            if (Math.abs(x) <= 1) {\r\n                Tm = Math.cos(M * Math.acos(x));\r\n            } else {\r\n                Tm = Math.cosh(M * Math.acosh(x));\r\n            }\r\n            const coeff = ((k === 0 || k === M) ? 0.5 : 1) * Tm * Math.cos(Math.PI * n * (k - M / 2) / M);\r\n            sum += coeff;\r\n        }\r\n        window[n] = sum;\r\n    }\r\n\r\n    return window;\r\n}\r\n\r\nfunction rectangularWindow(length: number): Float32Array {\r\n    const window = new Float32Array(length);\r\n    window.fill(1);\r\n    return window;\r\n}\r\n\r\nexport function getSelectedWindow(windowType: WindowType, length: number, correct: boolean = true): Float32Array {\r\n    const type = windowType;\r\n    let window = new Float32Array(length);\r\n    let wcf = 1; // Window correction factor\r\n    if (type === 'hanning') { window = hanningWindow(length); wcf = 2.000; }\r\n    if (type === 'hamming') { window = hammingWindow(length); wcf = 1.852; }\r\n    if (type === 'blackman') { window = blackmanWindow(length); wcf = 2.381; }\r\n    if (type === 'rectangular') { window = rectangularWindow(length); wcf = 1.000; }\r\n    if (correct) {\r\n        window = window.map(v => v / wcf); // Scale to max 2 for better visualization\r\n    }\r\n\r\n    return window;\r\n}\r\n\r\nexport function tukeyWindow(length: number, alpha: number = 0.5): Float32Array {\r\n    if (length < 1) return new Float32Array(0);\r\n    if (length === 1) return new Float32Array([1]);\r\n    const N = length;\r\n    const w = new Float32Array(N);\r\n\r\n    if (alpha <= 0) {\r\n        w.fill(1); // rectangular\r\n        return w;\r\n    }\r\n    if (alpha >= 1) {\r\n        // Equivalent to a Hann/Hanning window\r\n        for (let i = 0; i < N; i++) {\r\n            w[i] = 0.5 * (1 - Math.cos((2 * Math.PI * i) / (N - 1)));\r\n        }\r\n        return w;\r\n    }\r\n\r\n    const edge = alpha * (N - 1) / 2;\r\n    const denom = alpha * (N - 1);\r\n\r\n    for (let n = 0; n < N; n++) {\r\n        if (n <= edge) {\r\n            w[n] = 0.5 * (1 + Math.cos(Math.PI * ((2 * n) / denom - 1)));\r\n        } else if (n >= (N - 1 - edge)) {\r\n            // symmetric tail\r\n            const m = N - 1 - n;\r\n            w[n] = 0.5 * (1 + Math.cos(Math.PI * ((2 * m) / denom - 1)));\r\n        } else {\r\n            w[n] = 1;\r\n        }\r\n    }\r\n\r\n    return w;\r\n}","export const COLORS = ['#1f77b4', '#ff7f0e', '#2ca02c', '#d62728', '#9467bd', '#8c564b', '#e377c2', '#7f7f7f', '#bcbd22', '#17becf'];\n\nfunction addPlotToList(tabId: string, plotId: string, plotName: string, hidden: boolean = false): void {\n    const plotList = document.getElementById(`plot-list-${tabId}`) as HTMLElement;\n    const listItem = document.createElement('li');\n    listItem.innerHTML = `<input type=\"checkbox\" id=\"checkbox-${plotId}\" alt=\"show/hide\" ${hidden ? '' : 'checked'}><label for=\"checkbox-${plotId}\">${plotName}</label>`;\n    plotList.appendChild(listItem);\n}\n\nfunction addPlotElement(tabId: string, plotId: string, hidden: boolean = false): HTMLElement {\n    const tabContent = document.querySelector(`[data-content=\"${tabId}\"]`) as HTMLElement;\n    const plotBox = document.createElement('div');\n    plotBox.className = 'plot-box';\n    plotBox.innerHTML = `\n        <div id=\"${plotId}\" class=\"plot-medium\"></div>\n        <div class=\"button-bar\">\n            <button>Customize...</button>\n            <button>Export as...</button>   \n            <label for=\"checkbox-${plotId}\">Hide</label>\n        </div>\n    `;\n    tabContent.querySelector('.plot-outer')?.appendChild(plotBox);\n    if (hidden) {\n        plotBox.style.display = 'none';\n    }\n    return plotBox.querySelector(`#${plotId}`) as HTMLElement;\n}\n\nexport function plot(\n    traces: any[], \n    tabId: string,\n    title: string, \n    xTitle: string, \n    yTitle: string, \n    xAxisExtras: any = {},\n    yAxisExtras: any = {},\n    layoutExtras: any = {},\n    hidden: boolean = false,\n): void {\n    const plotSettings: {[key: string]: any} = {\n        plotGlPixelRatio: 2, // For better clarity on high-DPI screens\n        legend: {\"orientation\": \"h\", \"y\": -0.2, \"yanchor\": \"top\"},\n        plot_bgcolor: '#fafbfc',\n        paper_bgcolor: '#fff',\n        staticPlot: false, // Enable interactivity\n        dragmode: 'pan',\n        showAxisDragHandles: true,\n        showAxisRangeEntryBoxes: true,\n        axisDragOnHover: true,\n        tightenLats: true,\n        font: {\n            family: \"'Newsreader', Georgia, 'Times New Roman', Times, serif\",\n        },\n        margin: { t: 80, r: 65, b: 70, l: 65 }\n    };\n\n    const layout = {\n        title: title,\n        xaxis: { \n            title: xTitle,\n            gridcolor: '#e1e4e8',\n            //tickformat: '.0f',\n            ...xAxisExtras\n        },\n        yaxis: { \n            title: yTitle,\n            gridcolor: '#e1e4e8',\n            automargin: true,\n            ...yAxisExtras\n        },\n        ...layoutExtras,\n        ...plotSettings\n    };\n\n    const plotId = `plot-${tabId}-${title.toLowerCase().replace(/\\s+/g, '-')}`;\n\n    const element = addPlotElement(tabId, plotId, hidden);\n    (window as any).Plotly.newPlot(element, traces, layout, {responsive: true});\n    addPlotToList(tabId, plotId, title, hidden);\n\n    document.getElementById(`checkbox-${plotId}`)?.addEventListener('change', (e) => {\n        const box = document.getElementById(`${plotId}`)!.parentElement!;\n        box.setAttribute('style', (e.target as HTMLInputElement).checked ? 'display: block;' : 'display: none;');\n        window.dispatchEvent(new Event('resize'));\n    });\n\n    console.log(`Plotted ${title} in tab ${tabId}`);\n}\n\n","import { closest, linspace, max } from './math';\nimport { getSelectedWindow } from './windows';\nimport { computeFFTFromIR, db, fftConvolve, smoothFFT } from './audio';\nimport { ImpulseResponseResult } from './audio';\nimport { plot, COLORS } from './plotting';\n\nexport class Farina {\n    /* Farina deconvolution implementation according to the Python implementation. */\n    constructor(stimulus: Float32Array, f_start: number = 50, f_stop: number = 22800, fs: number = 48000) {\n        this.f_start = f_start;\n        this.f_stop = f_stop;\n        this.fs = fs;\n        this.stimulus = stimulus;\n        this.duration = (this.stimulus.length - 528) / this.fs;\n    }\n\n    f_start: number;\n    f_stop: number;\n    fs: number;\n    stimulus: Float32Array;\n    deconvolved: Float32Array = Float32Array.from([]);\n    duration: number;\n\n    lag_of_harmonic(n: number) {\n        return this.ell() * Math.log(n);\n    }\n\n    margin_of_harmonic(n: number) {\n        return this.ell() * Math.log(n + 1) - this.ell() * Math.log(n);\n    }\n\n    max_safe_harmonic(window_size: number): number {\n        const t: number[] = [];\n        for (let n = 1; n < 1000; n++) {\n            if (this.margin_of_harmonic(n) > window_size) {\n                t.push(this.margin_of_harmonic(n));\n            }\n        }\n        return t.length < 999 ? t.length : 0;\n    }\n\n    ell(): number {\n        return this.duration / Math.log(this.f_stop / this.f_start);\n    }\n\n    rate(length: number): number {\n        return 1 / this.f_start * Math.PI * Math.round(length * this.f_start / Math.log2(this.f_stop / this.f_start));\n    }\n\n    instant(): number {\n        // Lag between the start of the sweep and the stimulus.\n        return closest(100000000, this.deconvolved);\n    }\n\n    window(signal: ImpulseResponseResult, at: number, length: number): ImpulseResponseResult {\n        const size = Math.floor(length * this.fs);\n        const window: Float32Array = getSelectedWindow('hanning', size, false);\n\n        const si = signal.ir.slice(at - size / 2, at + size / 2);\n        const w = Float32Array.from({ length: size }, () => 0);\n\n        if (si.length === window.length) {\n            for (let i = 0; i < window.length; i++) {\n                w[i] = window[i] * si[i];\n            }\n        }\n\n        const ir_complex = Float32Array.from({ length: w.length * 2 }, () => 0);\n        for (let i = 0; i < w.length; i++) {\n            ir_complex[2 * i] = w[i];\n            ir_complex[2 * i + 1] = 0;\n        }\n\n        return {\n            ir: w,\n            ir_complex,\n            t: linspace((-size - 1) / 2 / this.fs, (size - 1) / 2 / this.fs, size),\n            peakAt: at,\n            sampleRate: this.fs,\n            fftSize: w.length,\n        }\n    }\n\n    deconvolution(signal: Float32Array): Float32Array {\n        const n: Float32Array = linspace(0, this.stimulus.length - 1, this.stimulus.length);\n        const ell = this.ell();\n        const k: Float32Array = n.map(v => Math.exp(v / ell / this.fs)); // simplified for first element\n\n        const inv_stimulus = this.stimulus.slice().reverse().map ((v, i) => v / k[i]);\n\n        const deconvolved: Float32Array = fftConvolve(signal, inv_stimulus, 'same').slice();\n        const norm = max(fftConvolve(this.stimulus, inv_stimulus, 'same').map(v => Math.abs(v)));\n\n        this.deconvolved = deconvolved.map(v => v / norm);\n        return this.deconvolved;\n    }\n\n    deconvolvedResponse(signal: Float32Array): ImpulseResponseResult {\n        const ir = this.deconvolution(signal);\n        const peakAt = this.instant();\n\n        const ir_complex = Float32Array.from({ length: ir.length * 2 }, () => 0);\n        for (let i = 0; i < ir.length; i++) {\n                ir_complex[2 * i] = ir[i];\n                ir_complex[2 * i + 1] = 0;\n        }\n\n        return {\n            ir,\n            ir_complex,\n            t: linspace((- peakAt)/ this.fs, (- peakAt + ir.length - 1)/ this.fs, ir.length),\n            peakAt,\n            sampleRate: this.fs,\n            fftSize: ir.length,\n        };\n    }\n\n    harmonics(windowSize: number, harmonicsCount: number): ImpulseResponseResult[] {\n        const results: ImpulseResponseResult[] = [];\n        for (let n = 0; n <= harmonicsCount; n++) {\n            const at = Math.round(this.instant() - this.lag_of_harmonic(n + 1) * this.fs);\n            const w = this.window({\n                ir: this.deconvolved,\n                ir_complex: Float32Array.from([]),\n                t: Float32Array.from([]),\n                peakAt: at,\n                sampleRate: this.fs,\n                fftSize: this.deconvolved.length,\n            }, at, windowSize);\n            results.push(w);\n        }\n        return results;\n    }\n\n}\n\nexport function plotDistortion(farina: Farina, windowSize: number, maxHarmonics: number, tabId: string): void {\n    const harmonics = farina.harmonics(windowSize, maxHarmonics);\n    const harmonicsFFT = harmonics.map((h, n) => computeFFTFromIR(h, 1000, 1 / (n + 1)));\n    const smoothedHarmonicsFFT = harmonicsFFT.map(hf => smoothFFT(hf, 1/6, 1/96));\n\n    const traces: any[] = [];\n    for (let n = 0; n < smoothedHarmonicsFFT.length; n++) {\n        const color = COLORS[n % COLORS.length];\n\n        const response = harmonicsFFT[n];\n        const smoothedResponse = smoothedHarmonicsFFT[n];\n        if (n === 0) {\n            traces.push({\n                x: response.frequency.map(f => f / (n + 1)),\n                y: db(response.magnitude),\n                type: 'scatter',\n                mode: 'lines',\n                name: n === 0 ? 'Fundamental' : `Harmonic ${n + 1}`,\n                line: {\n                    width: .75,\n                    color: color + '33', // Lighter color for raw\n                },\n                showlegend: n === 0,\n            });\n        }\n        traces.push({\n            x: smoothedResponse.frequency.map(f => f / (n + 1)),\n            y: db(smoothedResponse.magnitude),\n            type: 'scatter',\n            mode: 'lines',\n            name: (n === 0 ? 'Fundamental' : `Harmonic ${n + 1}`) + ' (Smoothed)',\n            line: {\n                width: 1.5,\n                color: color,\n            },\n        });\n\n        \n    }\n    plot(\n        traces,\n        tabId, \n        'Fundamental and Harmonic Distortion', \n        'Frequency (Hz)', \n        'Amplitude (dBFS)',\n        {type: 'log', range: [Math.log10(20), Math.log10(20000)]}, \n        {range: [-85, 5]},\n        {}, \n        false\n    );\n}\n\nexport function plotTHD(farina: Farina, windowSize: number, maxHarmonics: number, tabId: string): void {\n    const harmonics = farina.harmonics(windowSize, maxHarmonics);\n    const harmonicsFFT = harmonics.map((h, n) => computeFFTFromIR(h, 1000, 1 / (n + 1)));\n    const smoothedHarmonicsFFT = harmonicsFFT.map(hf => smoothFFT(hf, 1/6, 1/96));\n\n    const fundamental = smoothedHarmonicsFFT[0];\n    const traces: any[] = [];\n\n    const thd: Float32Array = Float32Array.from({ length: fundamental.magnitude.length }, () => 0);\n    for (let i = 0; i < fundamental.magnitude.length; i++) {\n        let sumSquares = 0;\n        for (let n = 1; n < smoothedHarmonicsFFT.length; n++) {\n            sumSquares += Math.pow(smoothedHarmonicsFFT[n].magnitude[i], 2);\n        }\n        thd[i] = Math.sqrt(sumSquares) / fundamental.magnitude[i];\n    }\n\n    traces.push({\n        x: fundamental.frequency,\n        y: thd.map(v => v * 100), // Convert to percentage\n        type: 'scatter',\n        mode: 'lines',\n        name: 'Total Harmonic Distortion (THD)',\n        line: {\n            width: 1.5,\n            color: COLORS[0],\n        },\n    });\n\n    plot(\n        traces,\n        tabId, \n        'Total Harmonic Distortion', \n        'Frequency (Hz)', \n        'THD (%)',\n        {type: 'log', range: [Math.log10(20), Math.log10(20000)]}, \n        {range: [0, 5]},\n        {}, \n        false\n    );  \n}\n","// IndexedDB-backed storage helpers\nfunction openIDB(): Promise<IDBDatabase> {\n    return new Promise((resolve, reject) => {\n        const req = indexedDB.open('dunkadunka-storage', 1);\n        req.onupgradeneeded = () => {\n            const db = req.result;\n            if (!db.objectStoreNames.contains('kv')) {\n                db.createObjectStore('kv', { keyPath: 'key' });\n            }\n        };\n        req.onsuccess = () => resolve(req.result);\n        req.onerror = () => reject(req.error);\n    });\n}\n\nasync function setItem(key: string, value: string): Promise<void> {\n    try {\n        const db = await openIDB();\n        const tx = db.transaction('kv', 'readwrite');\n        const store = tx.objectStore('kv');\n        store.put({ key, value });\n        await new Promise<void>((resolve, reject) => {\n            tx.oncomplete = () => resolve();\n            tx.onerror = () => reject(tx.error);\n            tx.onabort = () => reject(tx.error);\n        });\n        // mirror to sessionStorage for synchronous reads elsewhere\n        try { setItem(key, value); } catch { /* ignore */ }\n    } catch (e) {\n        console.error('setItem(idb) failed', e);\n    }\n}\n\nasync function getItem(key: string): Promise<string | null> {\n    try {\n        const db = await openIDB();\n        const tx = db.transaction('kv', 'readonly');\n        const store = tx.objectStore('kv');\n        const req = store.get(key);\n        const res = await new Promise<any>((resolve, reject) => {\n            req.onsuccess = () => resolve(req.result);\n            req.onerror = () => reject(req.error);\n        });\n        return res?.value ?? null;\n    } catch (e) {\n        console.error('getItem(idb) failed', e);\n        return null;\n    }\n}\n\nasync function removeItem(key: string): Promise<void> {\n    try {\n        const db = await openIDB();\n        const tx = db.transaction('kv', 'readwrite');\n        const store = tx.objectStore('kv');\n        store.delete(key);\n        await new Promise<void>((resolve, reject) => {\n            tx.oncomplete = () => resolve();\n            tx.onerror = () => reject(tx.error);\n            tx.onabort = () => reject(tx.error);\n        });\n    } catch (e) {\n        console.error('removeItem(idb) failed', e);\n    }\n}\n\nasync function clearStorage(): Promise<void> {\n    try {\n        const db = await openIDB();\n        const tx = db.transaction('kv', 'readwrite');\n        const store = tx.objectStore('kv');\n        store.clear();\n        await new Promise<void>((resolve, reject) => {\n            tx.oncomplete = () => resolve();\n            tx.onerror = () => reject(tx.error);\n            tx.onabort = () => reject(tx.error);\n        });\n        // also clear sessionStorage\n        try { sessionStorage.clear(); } catch { /* ignore */ }\n    } catch (e) {\n        console.error('clearStorage(idb) failed', e);\n    }\n}\n\nasync function dumpStorage(): Promise<void> {\n    try {\n        const db = await openIDB();\n        const tx = db.transaction('kv', 'readonly');\n        const store = tx.objectStore('kv');\n        const req = store.openCursor();\n        req.onsuccess = (event) => {\n            const cursor = (event.target as IDBRequest).result;\n            if (cursor) {\n                console.log(`Key: ${cursor.key}, Value: ${cursor.value.value}`);\n                cursor.continue();\n            }\n        };\n        req.onerror = () => {\n            console.error('dumpStorage(idb) failed', req.error);\n        };\n    } catch (e) {\n        console.error('dumpStorage(idb) failed', e);\n    }\n}\n\nexport const storage = {\n    setItem,\n    getItem,\n    removeItem,\n    clearStorage,\n    dumpStorage\n};","// Device settings for audio input/output selection\n\nconst INPUT_KEY = 'preferredAudioInputId';\nconst OUTPUT_KEY = 'preferredAudioOutputId';\n\nexport function openDeviceSettings(): void {\n    const modal = document.getElementById('deviceSettingsModal');\n    if (modal) {\n        modal.style.display = 'flex';\n        initDeviceSettings();\n    }\n}\n\nexport function closeDeviceSettings(): void {\n    const modal = document.getElementById('deviceSettingsModal');\n    if (modal) {\n        modal.style.display = 'none';\n    }\n}\n\nasync function ensureDeviceAccess(): Promise<void> {\n    try {\n        if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) return;\n        // Request permission so labels are revealed\n        await navigator.mediaDevices.getUserMedia({ audio: true, video: false });\n    } catch (_) {\n        // Permission may be denied; device labels may be blank\n    }\n}\n\nexport async function refreshAudioDeviceList(): Promise<void> {\n    if (!navigator.mediaDevices || !navigator.mediaDevices.enumerateDevices) {\n        console.warn('MediaDevices API not available');\n        return;\n    }\n\n    await ensureDeviceAccess();\n\n    const devices = await navigator.mediaDevices.enumerateDevices();\n    const inputSel = document.getElementById('inputDeviceSelect') as HTMLSelectElement | null;\n    const outputSel = document.getElementById('outputDeviceSelect') as HTMLSelectElement | null;\n\n    if (!inputSel || !outputSel) return;\n\n    inputSel.innerHTML = '<option value=\"\">Default input</option>';\n    outputSel.innerHTML = '<option value=\"\">Default output</option>';\n\n    const inputId = localStorage.getItem(INPUT_KEY) || '';\n    const outputId = localStorage.getItem(OUTPUT_KEY) || '';\n\n    devices.forEach(d => {\n        if (d.kind === 'audioinput') {\n            const opt = document.createElement('option');\n            opt.value = d.deviceId;\n            opt.textContent = d.label || `Microphone (${d.deviceId.slice(0, 8)})`;\n            if (d.deviceId === inputId) opt.selected = true;\n            inputSel.appendChild(opt);\n        } else if (d.kind === 'audiooutput') {\n            const opt = document.createElement('option');\n            opt.value = d.deviceId;\n            opt.textContent = d.label || `Speaker (${d.deviceId.slice(0, 8)})`;\n            if (d.deviceId === outputId) opt.selected = true;\n            outputSel.appendChild(opt);\n        }\n    });\n\n    const note = document.getElementById('sinkSupportNote');\n    if (note) {\n        const sinkSupported = typeof HTMLMediaElement !== 'undefined' && 'setSinkId' in HTMLMediaElement.prototype;\n        note.textContent = sinkSupported\n            ? 'Output routing supported on this browser.'\n            : 'Output routing (setSinkId) not supported by this browser.';\n    }\n}\n\nasync function applyOutputDevice(deviceId: string): Promise<void> {\n    const router = document.getElementById('appOutputRouter') as HTMLAudioElement | null;\n    if (!router) return;\n\n    if ('setSinkId' in HTMLMediaElement.prototype) {\n        try {\n            await (router as any).setSinkId(deviceId || '');\n        } catch (e) {\n            console.warn('Failed to set sinkId:', e);\n        }\n    }\n}\n\nexport function saveDeviceSelections(): void {\n    const inputSel = document.getElementById('inputDeviceSelect') as HTMLSelectElement | null;\n    const outputSel = document.getElementById('outputDeviceSelect') as HTMLSelectElement | null;\n\n    if (!inputSel || !outputSel) return;\n\n    localStorage.setItem(INPUT_KEY, inputSel.value || '');\n    localStorage.setItem(OUTPUT_KEY, outputSel.value || '');\n\n    applyOutputDevice(outputSel.value || '');\n    closeDeviceSettings();\n}\n\nasync function initDeviceSettings(): Promise<void> {\n    await refreshAudioDeviceList();\n\n    // Persist immediately when changed\n    const inputSel = document.getElementById('inputDeviceSelect') as HTMLSelectElement | null;\n    const outputSel = document.getElementById('outputDeviceSelect') as HTMLSelectElement | null;\n\n    if (!inputSel || !outputSel) return;\n\n    inputSel.onchange = () => {\n        localStorage.setItem(INPUT_KEY, inputSel.value || '');\n    };\n    outputSel.onchange = () => {\n        localStorage.setItem(OUTPUT_KEY, outputSel.value || '');\n        applyOutputDevice(outputSel.value || '');\n    };\n}\n\n// Update list if devices change while modal is open\nif (navigator.mediaDevices && 'ondevicechange' in navigator.mediaDevices) {\n    navigator.mediaDevices.addEventListener('devicechange', () => {\n        const modal = document.getElementById('deviceSettingsModal');\n        if (modal && modal.style.display === 'flex') {\n            refreshAudioDeviceList();\n        }\n    });\n}\n\n// Apply preferred output on load (best-effort)\ndocument.addEventListener('DOMContentLoaded', () => {\n    const outId = localStorage.getItem(OUTPUT_KEY);\n    if (outId) applyOutputDevice(outId);\n});\n\n// Export functions to global scope for inline onclick handlers\n(window as any).openDeviceSettings = openDeviceSettings;\n(window as any).closeDeviceSettings = closeDeviceSettings;\n(window as any).refreshAudioDeviceList = refreshAudioDeviceList;\n(window as any).saveDeviceSelections = saveDeviceSelections;\n","import audio from \"./audio\";\n\nexport class AudioRecorder {\n    streamSource: MediaStreamAudioSourceNode;\n    isRecording: boolean = false;\n\n    constructor(streamSource: MediaStreamAudioSourceNode) {\n        this.streamSource = streamSource;\n\n    }\n\n    async record(durationSec: number): Promise<Float32Array[]> {\n        const recording: Float32Array[] = [\n            new Float32Array(durationSec * this.streamSource.context.sampleRate),\n            new Float32Array(durationSec * this.streamSource.context.sampleRate)\n        ];\n        let pointer = 0;\n\n        await this.streamSource.context.audioWorklet.addModule('static/buffering-processor.worklet.js');\n        const worklet = new AudioWorkletNode(\n            this.streamSource.context, 'buffering-processor', {\n            numberOfInputs: 1,\n            numberOfOutputs: 0,\n            processorOptions: {\n                buffer: null\n            }\n        });\n\n        this.streamSource.connect(worklet);\n\n        worklet.port.onmessage = (event) => {\n            if (this.isRecording) {\n                if (pointer + event.data.buffer[0]?.length > recording[0]?.length) {\n                    this.isRecording = false;\n                    return new Promise<Float32Array[]>((resolve) => { resolve(recording); });\n                }\n                recording[0].set(event.data.buffer[0], pointer);\n                recording[1].set(event.data.buffer[1], pointer);\n                pointer += event.data.buffer[0]?.length;\n            }\n        };\n\n        return new Promise<Float32Array[]>((resolve) => {\n            setTimeout(() => {\n                worklet.disconnect();\n                this.streamSource.disconnect();\n                this.streamSource.mediaStream.getTracks().forEach(track => track.stop());\n                resolve(recording);\n                this.isRecording = false;\n            }, durationSec * 1000);\n        });\n\n        this.isRecording = true;\n    }\n}","export interface BextChunk {\n  description?: string;\n  originator?: string;\n  originatorReference?: string;\n  originationDate?: string;\n  originationTime?: string;\n  timeReference?: string; // 64-bit time reference as decimal string\n  version?: number;\n  umid?: Uint8Array | null;\n  codingHistory?: string;\n}\n\nexport interface WaveReadResult {\n  samples: Float32Array; // interleaved\n  sampleRate: number;\n  channels: number;\n  bitsPerSample: number;\n  format: number;\n  frames: number;\n  bext?: BextChunk | null;\n  ixml?: string | null;\n}\n\nexport function download(\n  samples: Float32Array | number[],\n  sampleRate = 48000,\n  name = 'output',\n  bext?: BextChunk | null,\n  ixml?: string | null\n): void {\n  const channels = 1;\n  const bytesPerSample = 4;\n  const blockAlign = channels * bytesPerSample;\n  const byteRate = sampleRate * blockAlign;\n  const dataSize = samples.length * bytesPerSample;\n\n  // build bext payload if requested\n  let bextDataSize = 0;\n  let bextPayload: Uint8Array | null = null;\n  if (bext) {\n    const description = bext.description || '';\n    const originator = bext.originator || '';\n    const originatorReference = bext.originatorReference || '';\n    const originationDate = bext.originationDate || '';\n    const originationTime = bext.originationTime || '';\n    const codingHistory = bext.codingHistory || '';\n    const version = typeof bext.version === 'number' ? bext.version : 1;\n    const umidBytes = bext.umid && bext.umid.length ? bext.umid : null;\n\n    // base BEXT fields per spec: 256 + 32 + 32 + 10 + 8 + 8 + 2 + 64 + 190 = 602 bytes\n    const baseLen = 602;\n    const codingLen = codingHistory ? codingHistory.length + 1 : 0; // include null terminator if present\n    bextDataSize = baseLen + codingLen;\n\n    // ensure even length (chunk payload is padded to even)\n    if (bextDataSize % 2 === 1) bextDataSize++;\n\n    bextPayload = new Uint8Array(bextDataSize);\n    let p = 0;\n    const writeFixed = (str: string, len: number) => {\n      for (let i = 0; i < len; i++) {\n        const code = i < str.length ? str.charCodeAt(i) & 0xff : 0;\n        bextPayload![p++] = code;\n      }\n    };\n\n    writeFixed(description, 256);\n    writeFixed(originator, 32);\n    writeFixed(originatorReference, 32);\n    writeFixed(originationDate, 10);\n    writeFixed(originationTime, 8);\n\n    // time reference 64-bit little-endian: low then high (as in read())\n    let timeRefLow = 0;\n    let timeRefHigh = 0;\n    try {\n      const tr = bext.timeReference || '0';\n      const BigIntFn = (globalThis as any).BigInt;\n      if (typeof BigIntFn === 'function') {\n        const t = BigIntFn(tr);\n        const mask = BigIntFn(0xffffffff);\n        timeRefLow = Number(t & mask);\n        timeRefHigh = Number((t >> BigIntFn(32)) & mask);\n      } else {\n        const n = Number(tr || 0);\n        timeRefLow = Math.floor(n % 4294967296);\n        timeRefHigh = Math.floor(n / 4294967296);\n      }\n    } catch {\n      timeRefLow = 0;\n      timeRefHigh = 0;\n    }\n    // write low then high (little endian)\n    bextPayload[p++] = timeRefLow & 0xff;\n    bextPayload[p++] = (timeRefLow >>> 8) & 0xff;\n    bextPayload[p++] = (timeRefLow >>> 16) & 0xff;\n    bextPayload[p++] = (timeRefLow >>> 24) & 0xff;\n    bextPayload[p++] = timeRefHigh & 0xff;\n    bextPayload[p++] = (timeRefHigh >>> 8) & 0xff;\n    bextPayload[p++] = (timeRefHigh >>> 16) & 0xff;\n    bextPayload[p++] = (timeRefHigh >>> 24) & 0xff;\n\n    // version (2 bytes LE)\n    bextPayload[p++] = version & 0xff;\n    bextPayload[p++] = (version >>> 8) & 0xff;\n\n    // UMID (64 bytes) if version>0, otherwise zeros\n    if (version > 0) {\n      if (umidBytes) {\n        for (let i = 0; i < 64; i++) bextPayload[p++] = i < umidBytes.length ? umidBytes[i] : 0;\n      } else {\n        for (let i = 0; i < 64; i++) bextPayload[p++] = 0;\n      }\n    } else {\n      for (let i = 0; i < 64; i++) bextPayload[p++] = 0;\n    }\n\n    // reserved 190 bytes\n    for (let i = 0; i < 190; i++) bextPayload[p++] = 0;\n\n    // coding history (ASCII) + null terminator if provided\n    if (codingHistory) {\n      for (let i = 0; i < codingHistory.length; i++) bextPayload[p++] = codingHistory.charCodeAt(i) & 0xff;\n      bextPayload[p++] = 0;\n    }\n\n    // pad if needed\n    while (p < bextDataSize) bextPayload[p++] = 0;\n  }\n\n  // build iXML payload if requested\n  let ixmlDataSize = 0;\n  let ixmlPayload: Uint8Array | null = null;\n  if (ixml) {\n    const enc = (globalThis as any).TextEncoder ? new TextEncoder() : null;\n    if (enc) ixmlPayload = enc.encode(ixml);\n    else {\n      const arr = new Uint8Array(ixml.length);\n      for (let i = 0; i < ixml.length; i++) arr[i] = ixml.charCodeAt(i) & 0xff;\n      ixmlPayload = arr;\n    }\n    ixmlDataSize = ixmlPayload.length;\n    if (ixmlDataSize % 2 === 1) ixmlDataSize++;\n  }\n\n  // compute total buffer size with chunks and padding\n  const fmtChunkSize = 8 + 16;\n  const bextChunkSize = bextPayload ? 8 + bextDataSize : 0;\n  const ixmlChunkSize = ixmlPayload ? 8 + ixmlDataSize : 0;\n  const dataChunkSize = 8 + dataSize + (dataSize % 2 === 1 ? 1 : 0);\n  const riffBodySize = 4 + fmtChunkSize + bextChunkSize + ixmlChunkSize + dataChunkSize; // 'WAVE' + chunks\n  const totalSize = 8 + riffBodySize; // RIFF header (8) + body\n\n  const buffer = new ArrayBuffer(totalSize);\n  const view = new DataView(buffer);\n\n  function writeString(offset: number, str: string) {\n    for (let i = 0; i < str.length; i++) view.setUint8(offset + i, str.charCodeAt(i));\n  }\n\n  // RIFF header\n  writeString(0, 'RIFF');\n  view.setUint32(4, riffBodySize, true);\n  writeString(8, 'WAVE');\n\n  // fmt chunk\n  let ptr = 12;\n  writeString(ptr, 'fmt ');\n  view.setUint32(ptr + 4, 16, true);\n  view.setUint16(ptr + 8, 1, true); // PCM\n  view.setUint16(ptr + 10, channels, true);\n  view.setUint32(ptr + 12, sampleRate, true);\n  view.setUint32(ptr + 16, byteRate, true);\n  view.setUint16(ptr + 20, blockAlign, true);\n  view.setUint16(ptr + 22, 16, true); // bits per sample\n  ptr += 8 + 16;\n\n  // bext chunk (optional)\n  if (bextPayload) {\n    writeString(ptr, 'bext');\n    view.setUint32(ptr + 4, bextDataSize, true);\n    ptr += 8;\n    // copy payload\n    new Uint8Array(buffer, ptr, bextDataSize).set(bextPayload);\n    ptr += bextDataSize;\n    if (bextDataSize % 2 === 1) {\n      view.setUint8(ptr, 0);\n      ptr++;\n    }\n  }\n\n  // iXML chunk (optional)\n  if (ixmlPayload) {\n    writeString(ptr, 'iXML');\n    view.setUint32(ptr + 4, ixmlDataSize, true);\n    ptr += 8;\n    const dest = new Uint8Array(buffer, ptr, ixmlDataSize);\n    dest.set(ixmlPayload);\n    // zero pad remainder if odd sized\n    if (ixmlDataSize > ixmlPayload.length) {\n      for (let i = ixmlPayload.length; i < ixmlDataSize; i++) dest[i] = 0;\n    }\n    ptr += ixmlDataSize;\n    if (ixmlDataSize % 2 === 1) {\n      view.setUint8(ptr, 0);\n      ptr++;\n    }\n  }\n\n  // data chunk\n  writeString(ptr, 'data');\n  view.setUint32(ptr + 4, dataSize, true);\n  ptr += 8;\n\n  // PCM 16-bit samples\n  let off = ptr;\n  for (let i = 0; i < samples.length; i++, off += 2) {\n    const s = Math.max(-1, Math.min(1, Number(samples[i])));\n    view.setInt16(off, s < 0 ? s * 0x8000 : s * 0x7fff, true);\n  }\n  if (dataSize % 2 === 1) {\n    view.setUint8(off, 0);\n    off++;\n  }\n\n  const blob = new Blob([buffer], { type: 'audio/wav' });\n  const url = URL.createObjectURL(blob);\n  const a = document.createElement('a');\n  a.href = url;\n  a.download = name;\n  document.body.appendChild(a);\n  a.click();\n  a.remove();\n  URL.revokeObjectURL(url);\n}\n\nexport async function read(bufferOrBlob: Blob | ArrayBuffer | Uint8Array): Promise<WaveReadResult> {\n  let buffer: ArrayBuffer;\n  if (bufferOrBlob instanceof Blob) buffer = await bufferOrBlob.arrayBuffer();\n  else if (bufferOrBlob instanceof ArrayBuffer) buffer = bufferOrBlob;\n  else if (bufferOrBlob instanceof Uint8Array) {\n    const tmp = new ArrayBuffer(bufferOrBlob.byteLength);\n    new Uint8Array(tmp).set(bufferOrBlob);\n    buffer = tmp;\n  } else throw new TypeError('Expected Blob, ArrayBuffer or Uint8Array');\n\n  const view = new DataView(buffer);\n  const readStr = (off: number, len: number): string => {\n    let s = '';\n    for (let i = 0; i < len && off + i < view.byteLength; i++) {\n      const c = view.getUint8(off + i);\n      if (c === 0) break;\n      s += String.fromCharCode(c);\n    }\n    return s;\n  };\n\n  if (readStr(0, 4) !== 'RIFF' || readStr(8, 4) !== 'WAVE') throw new Error('Not a valid WAVE file');\n\n  let offset = 12;\n  let fmt: { audioFormat: number; channels: number; sampleRate: number; byteRate: number; blockAlign: number; bitsPerSample: number } | null = null;\n  let dataOffset = -1;\n  let dataSize = 0;\n  let bextChunk: BextChunk | null = null;\n  let ixmlChunk: string | null = null;\n\n  const readFixedString = (off: number, len: number) => {\n    const bytes: number[] = [];\n    for (let i = 0; i < len && off + i < view.byteLength; i++) {\n      bytes.push(view.getUint8(off + i));\n    }\n    // trim trailing nulls\n    let end = bytes.length;\n    while (end > 0 && bytes[end - 1] === 0) end--;\n    return String.fromCharCode(...bytes.slice(0, end));\n  };\n\n  while (offset + 8 <= view.byteLength) {\n    const id = readStr(offset, 4);\n    const size = view.getUint32(offset + 4, true);\n    const chunkStart = offset + 8;\n\n    if (id === 'fmt ') {\n      const audioFormat = view.getUint16(chunkStart, true);\n      const channels = view.getUint16(chunkStart + 2, true);\n      const sampleRate = view.getUint32(chunkStart + 4, true);\n      const byteRate = view.getUint32(chunkStart + 8, true);\n      const blockAlign = view.getUint16(chunkStart + 12, true);\n      const bitsPerSample = view.getUint16(chunkStart + 14, true);\n      fmt = { audioFormat, channels, sampleRate, byteRate, blockAlign, bitsPerSample };\n    } else if (id === 'data') {\n      dataOffset = chunkStart;\n      dataSize = size;\n    } else if (id === 'bext') {\n      // parse BWF bext chunk per available fields\n      let p = chunkStart;\n      const remaining = (chunkStart + size) - p;\n      const readLen = (n: number) => Math.max(0, Math.min(n, (chunkStart + size) - p));\n      const safeRead = (n: number) => {\n        const r = readLen(n);\n        const s = readFixedString(p, r);\n        p += n;\n        return s;\n      };\n\n      const description = readFixedString(p, Math.min(256, chunkStart + size - p));\n      p += 256;\n      const originator = readFixedString(p, Math.min(32, chunkStart + size - p));\n      p += 32;\n      const originatorReference = readFixedString(p, Math.min(32, chunkStart + size - p));\n      p += 32;\n      const originationDate = readFixedString(p, Math.min(10, chunkStart + size - p));\n      p += 10;\n      const originationTime = readFixedString(p, Math.min(8, chunkStart + size - p));\n      p += 8;\n\n      let timeRefLow = 0;\n      let timeRefHigh = 0;\n      if (p + 8 <= chunkStart + size) {\n        timeRefLow = view.getUint32(p, true);\n        timeRefHigh = view.getUint32(p + 4, true);\n      } else {\n        // read what's available\n        if (p + 4 <= chunkStart + size) timeRefLow = view.getUint32(p, true);\n      }\n      p += 8;\n\n      let version = 0;\n      if (p + 2 <= chunkStart + size) {\n        version = view.getUint16(p, true);\n      }\n      p += 2;\n\n      let umid: Uint8Array | null = null;\n      if (version > 0 && p + 64 <= chunkStart + size) {\n        umid = new Uint8Array(buffer.slice(p, p + 64));\n        p += 64;\n      } else if (version > 0) {\n        // if not enough space, read what's there\n        const avail = Math.max(0, (chunkStart + size) - p);\n        if (avail > 0) {\n          umid = new Uint8Array(buffer.slice(p, p + avail));\n          p += avail;\n        }\n      }\n\n      // After UMID there may be reserved fields (190 bytes per spec), skip what's present\n      const reservedLen = 190;\n      const skipReserved = Math.min(reservedLen, Math.max(0, (chunkStart + size) - p));\n      p += skipReserved;\n\n      // The rest (if any) is coding history (ASCII)\n      let codingHistory = '';\n      if (p < chunkStart + size) {\n        // Read remaining bytes as string (may contain nulls)\n        const bytes = new Uint8Array(buffer, p, chunkStart + size - p);\n        let s = '';\n        for (let i = 0; i < bytes.length; i++) {\n          const c = bytes[i];\n          if (c === 0) break;\n          s += String.fromCharCode(c);\n        }\n        codingHistory = s;\n      }\n\n      // Combine timeRefHigh/Low into 64-bit decimal string\n      let timeReferenceStr = '0';\n      try {\n        // Use BigInt at runtime if available without referencing the global BigInt symbol\n        // directly (avoids TypeScript lib requirement); otherwise fall back to numeric math.\n        const BigIntFn = (globalThis as any).BigInt;\n        if (typeof BigIntFn === 'function') {\n          const hi = BigIntFn(timeRefHigh);\n          const lo = BigIntFn(timeRefLow);\n          const combined = (hi << BigIntFn(32)) | lo;\n          timeReferenceStr = combined.toString();\n        } else {\n          timeReferenceStr = (timeRefHigh * 4294967296 + timeRefLow).toString();\n        }\n      } catch {\n        timeReferenceStr = (timeRefHigh * 4294967296 + timeRefLow).toString();\n      }\n\n      bextChunk = {\n        description: description || undefined,\n        originator: originator || undefined,\n        originatorReference: originatorReference || undefined,\n        originationDate: originationDate || undefined,\n        originationTime: originationTime || undefined,\n        timeReference: timeReferenceStr,\n        version,\n        umid,\n        codingHistory: codingHistory || undefined\n      };\n    } else if (id === 'iXML' || id === 'iXML') {\n      // iXML chunk: typically an XML string\n      const bytes = new Uint8Array(buffer, chunkStart, size);\n      let s = '';\n      for (let i = 0; i < bytes.length; i++) {\n        const c = bytes[i];\n        if (c === 0) break;\n        s += String.fromCharCode(c);\n      }\n      ixmlChunk = s;\n    }\n\n    offset = chunkStart + size;\n    if (size % 2 === 1) offset++; // pad byte\n  }\n\n  if (!fmt) throw new Error('Missing \"fmt \" chunk');\n  if (dataOffset < 0) throw new Error('Missing \"data\" chunk');\n\n  const { audioFormat, channels, sampleRate, bitsPerSample } = fmt;\n  const bytesPerSample = bitsPerSample / 8;\n  const totalFrames = Math.floor(dataSize / (bytesPerSample * channels));\n  const out = new Float32Array(totalFrames * channels);\n\n  let p = dataOffset;\n  if (audioFormat === 1) {\n    // PCM integer\n    if (bitsPerSample === 8) {\n      for (let i = 0, o = 0; i < totalFrames * channels; i++, o++) {\n        const v = view.getUint8(p++);\n        out[o] = (v - 128) / 128;\n      }\n    } else if (bitsPerSample === 16) {\n      for (let i = 0, o = 0; i < totalFrames * channels; i++, o++) {\n        const v = view.getInt16(p, true);\n        p += 2;\n        out[o] = v < 0 ? v / 0x8000 : v / 0x7fff;\n      }\n    } else if (bitsPerSample === 24) {\n      for (let i = 0, o = 0; i < totalFrames * channels; i++, o++) {\n        const b0 = view.getUint8(p++);\n        const b1 = view.getUint8(p++);\n        const b2 = view.getUint8(p++);\n        let val = (b2 << 16) | (b1 << 8) | b0;\n        if (val & 0x800000) val |= ~0xffffff;\n        out[o] = val / 8388608;\n      }\n    } else if (bitsPerSample === 32) {\n      for (let i = 0, o = 0; i < totalFrames * channels; i++, o++) {\n        const v = view.getInt32(p, true);\n        p += 4;\n        out[o] = v < 0 ? v / 0x80000000 : v / 0x7fffffff;\n      }\n    } else {\n      throw new Error('Unsupported PCM bitsPerSample: ' + bitsPerSample);\n    }\n  } else if (audioFormat === 3) {\n    // IEEE float\n    if (bitsPerSample !== 32 && bitsPerSample !== 64) throw new Error('Unsupported float bit depth: ' + bitsPerSample);\n    if (bitsPerSample === 32) {\n      for (let i = 0, o = 0; i < totalFrames * channels; i++, o++) {\n        out[o] = view.getFloat32(p, true);\n        p += 4;\n      }\n    } else {\n      for (let i = 0, o = 0; i < totalFrames * channels; i++, o++) {\n        out[o] = view.getFloat64(p, true);\n        p += 8;\n      }\n    }\n  } else {\n    throw new Error('Unsupported audio format: ' + audioFormat);\n  }\n\n  return {\n    samples: out,\n    sampleRate,\n    channels,\n    bitsPerSample,\n    format: audioFormat,\n    frames: totalFrames,\n    bext: bextChunk,\n    ixml: ixmlChunk\n  };\n}\n\n\nexport function convertToIXML(xmlContent: string): string {\n    return `<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<BWFXML>\n    <IXML_VERSION>3.01</IXML_VERSION>\n    <PROJECT>Converted Audio File</PROJECT>\n    <NOTE>Converted to iXML format.</NOTE>\n    <HISTORY></HISTORY>\n    <USER>${xmlContent}</USER>\n</BWFXML>`;\n}\n\nexport function convertIXMLtoObject(xmlString: string): any {\n    return xmlString\n}","import { Audio, computeFFT, updatedFFT, computeFFTFromIR, db, FFTResult, groupDelays, ImpulseResponseResult, loadAudioFromFilename, rms, smoothFFT, twoChannelFFT, twoChannelImpulseResponse, dbToLinear } from \"./audio\";\nimport { Farina, plotDistortion, plotTHD } from \"./farina\";\nimport { storage } from \"./storage\";\nimport { audio } from \"./audio\";\nimport \"./device-settings\";\nimport { average, linspace, max, nextPow2 } from \"./math\";\nimport { COLORS, plot } from \"./plotting\";\nimport { AudioRecorder } from \"./recorder\";\nimport { download, BextChunk, convertToIXML } from \"./wave\";\n\nconsole.debug(\"App module loaded\");\n\nconst fileMap: Map<string, Audio> = new Map();\nconst root = document.documentElement;\nconst uiColor = \"#0366d6\";\nroot.style.setProperty('--color', uiColor);\n\nlet tabCounter = 0;\nconst tabsContainer = document.getElementById('tabs-outer') as HTMLElement;\nconst tabsInnerContainer = document.getElementById('tabs') as HTMLElement;\nconst tabContents = document.getElementById('tab-contents') as HTMLElement;\nconst responseFileUploadInput = document.getElementById('responseFileUpload') as HTMLInputElement;\nconst referenceFileUploadInput = document.getElementById('referenceFileUpload') as HTMLInputElement;\nconst analyzeUploadBtn = document.getElementById('analyzeUploadBtn') as HTMLButtonElement;\n\n// Polar upload controls\nconst polarReferenceFileInput = document.getElementById('polarReferenceFile') as HTMLInputElement;\nconst polarMeasurementsEl = document.getElementById('polarMeasurements') as HTMLElement;\nconst addPolarMeasurementBtn = document.getElementById('addPolarMeasurementBtn') as HTMLButtonElement;\nconst analyzePolarBtn = document.getElementById('analyzePolarBtn') as HTMLButtonElement;\nconst polarStatusEl = document.getElementById('polarStatus') as HTMLElement;\n\n\ntype PolarMeasurement = { angleDeg: number; file: File };\n\nfunction normalizeAngleDeg(angleDeg: number): number {\n    let a = angleDeg % 360;\n    if (a < 0) a += 360;\n    return a;\n}\n\nconst statusMessage = document.getElementById('statusMessage') as HTMLElement;\nfunction setStatusMessage(message: string, isError: boolean = false): void {\n    statusMessage.textContent = message;\n    statusMessage.style.color = isError ? '#d73a49' : '#28a745';\n}\n\n// ============================================================================\n// Acquisition Tab Functionality\n// ============================================================================\n\ninterface AcquisitionState {\n    audioContext: AudioContext | null;\n    mediaRecorder: MediaRecorder | null;\n    recordedChunks: Blob[];\n    oscillatorNode: OscillatorNode | null;\n    playbackSource: AudioBufferSourceNode | null;\n    isRecording: boolean;\n}\n\nconst acquisitionState: AcquisitionState = {\n    audioContext: null,\n    mediaRecorder: null,\n    recordedChunks: [],\n    oscillatorNode: null,\n    playbackSource: null,\n    isRecording: false\n};\n\nconst startBtn = document.getElementById('startBtn') as HTMLButtonElement;\nconst stopBtn = document.getElementById('stopBtn') as HTMLButtonElement;\nconst playBtn = document.getElementById('playBtn') as HTMLButtonElement;\nconst stopPlayBtn = document.getElementById('stopPlayBtn') as HTMLButtonElement;\nconst sweepStartFreqInput = document.getElementById('sweepStartFreq') as HTMLInputElement;\nconst sweepEndFreqInput = document.getElementById('sweepEndFreq') as HTMLInputElement;\nconst sweepDurationInput = document.getElementById('sweepDuration') as HTMLInputElement;\nconst recordingStatusEl = document.getElementById('recordingStatus') as HTMLElement;\nconst recordingMeterEl = document.getElementById('recordingMeter') as HTMLElement;\nconst recordingVisualizationEl = document.getElementById('recordingVisualization') as HTMLElement;\nconst recordedAudioContainer = document.getElementById('recordedAudioContainer') as HTMLElement;\nconst recordedAudioEl = document.getElementById('recordedAudio') as HTMLAudioElement;\nconst analyzeRecordingBtn = document.getElementById('analyzeRecordingBtn') as HTMLButtonElement;\nconst viewWaveformBtn = document.getElementById('viewWaveformBtn') as HTMLButtonElement;\nconst channelSelectionContainer = document.getElementById('channelSelectionContainer') as HTMLElement;\nconst channelSelect = document.getElementById('channelSelect') as HTMLSelectElement;\n\nasync function initializeAudioContext(): Promise<AudioContext> {\n    if (!acquisitionState.audioContext) {\n        acquisitionState.audioContext = new (window.AudioContext || (window as any).webkitAudioContext)();\n    }\n    if (acquisitionState.audioContext.state === 'suspended') {\n        await acquisitionState.audioContext.resume();\n    }\n    return acquisitionState.audioContext;\n}\n\nasync function detectAndSetupChannels(): Promise<void> {\n    try {\n        // Request audio input to check channel count\n        const stream = await navigator.mediaDevices.getUserMedia({\n            audio: { echoCancellation: false, noiseSuppression: false, autoGainControl: false }\n        });\n\n        const audioContext = await initializeAudioContext();\n        const analyser = audioContext.createAnalyser();\n        const source = audioContext.createMediaStreamSource(stream);\n        source.connect(analyser);\n\n        // Get channel count from the stream\n        const channelCount = source.mediaStream.getAudioTracks()[0].getSettings()?.channelCount || 1;\n\n        // Stop the stream as we only need it for channel detection\n        stream.getTracks().forEach(track => track.stop());\n\n        // Populate channel selection\n        channelSelect.innerHTML = '';\n        for (let i = 0; i < channelCount; i++) {\n            const option = document.createElement('option');\n            option.value = i.toString();\n            const channelNames = ['Left', 'Right', 'Center', 'LFE', 'Back Left', 'Back Right'];\n            option.textContent = `Channel ${i + 1}${channelNames[i] ? ` (${channelNames[i]})` : ''}`;\n            channelSelect.appendChild(option);\n        }\n\n        // Show channel selection only if more than 1 channel\n        if (channelCount > 1) {\n            channelSelectionContainer.style.display = 'flex';\n        } else {\n            channelSelectionContainer.style.display = 'none';\n        }\n    } catch (error) {\n        console.error('Error detecting channels:', error);\n        channelSelectionContainer.style.display = 'none';\n    }\n}\n\n// Detect channels when the acquisition tab is opened\ntabsContainer.addEventListener('click', (e: MouseEvent) => {\n    const target = e.target as HTMLElement;\n    if (target.classList.contains('tab') && target.dataset.tab === 'acquisition') {\n        detectAndSetupChannels();\n    }\n});\n\nlet recorded = [Float32Array.from([]), Float32Array.from([])];\n\nasync function startRecordingAndPlayback(): Promise<void> {\n    try {\n        const audioContext = await initializeAudioContext();\n\n        // Generate and play sweep\n        const startFreq = parseFloat(sweepStartFreqInput.value);\n        const endFreq = parseFloat(sweepEndFreqInput.value);\n        const duration = parseFloat(sweepDurationInput.value);\n\n        // Pre and post recording buffers (in seconds)\n        const preRecordTime = 0.5;  // Start recording 0.5s before playback\n        const postRecordTime = 1.0; // Continue recording 1s after playback ends\n        const totalRecordTime = preRecordTime + duration + postRecordTime;\n\n        const [sweepSignal, ,] = audio.chirp(startFreq, endFreq, duration);\n\n        // Create audio buffer from sweep signal\n        const audioBuffer = audioContext.createBuffer(1, sweepSignal.length, audioContext.sampleRate);\n        const channelData = audioBuffer.getChannelData(0);\n        channelData.set(sweepSignal);\n\n        // Create gain nodes for monitoring\n        const sourceGain = audioContext.createGain();\n        sourceGain.gain.value = 0.5;\n\n        // Start recording\n        recordingStatusEl.textContent = `Recording for ${totalRecordTime.toFixed(1)}s...`;\n\n        const stream = await navigator.mediaDevices.getUserMedia({\n            audio: { echoCancellation: false, noiseSuppression: false, autoGainControl: false }\n        });\n\n        const recorder = new AudioRecorder(audioContext.createMediaStreamSource(stream));\n        const recorded = recorder.record(totalRecordTime);\n\n        // Update UI\n        startBtn.disabled = true;\n        stopBtn.disabled = false;\n        playBtn.disabled = true;\n        sweepStartFreqInput.disabled = true;\n        sweepEndFreqInput.disabled = true;\n        sweepDurationInput.disabled = true;\n\n        // Start playback after pre-record time\n        setTimeout(() => {\n            acquisitionState.playbackSource = audioContext.createBufferSource();\n            acquisitionState.playbackSource.buffer = audioBuffer;\n            acquisitionState.playbackSource.connect(sourceGain);\n            sourceGain.connect(audioContext.destination);\n            acquisitionState.playbackSource.start();\n        }, preRecordTime * 1000);\n\n        await recorded.then(data => {\n            const audio = Audio.fromSamples(data[0], 48000, { filename: `Recording ${new Date().toISOString()}` });\n            const id = `${Date.now().toString(36)}-${Math.random().toString(36).slice(2, 8)}`;\n            const li = createListItem(audio, id);\n            document.getElementById('fileList')?.appendChild(li);\n            console.log('Recorded audio saved with id:', id);\n            saveWaveformsToStorage(fileMap);\n\n            switchTab('upload');\n        }).then(() => {\n            // Any cleanup code if needed\n            stopRecording();\n            // Create Audio object and save.\n        });\n    } catch (error) {\n        console.error('Error starting recording:', error);\n        recordingStatusEl.textContent = `Error: ${(error as Error).message}`;\n        recordingStatusEl.style.color = '#d73a49';\n    }\n}\n\nasync function playbackOnly(): Promise<void> {\n    try {\n        const audioContext = await initializeAudioContext();\n\n        const startFreq = parseFloat(sweepStartFreqInput.value);\n        const endFreq = parseFloat(sweepEndFreqInput.value);\n        const duration = parseFloat(sweepDurationInput.value);\n\n        const [sweepSignal] = audio.chirp(startFreq, endFreq, duration);\n\n        // Create audio buffer from sweep signal\n        const audioBuffer = audioContext.createBuffer(1, sweepSignal.length, audioContext.sampleRate);\n        const channelData = audioBuffer.getChannelData(0);\n        channelData.set(sweepSignal);\n\n        // Create gain node\n        const sourceGain = audioContext.createGain();\n        sourceGain.gain.value = 0.5;\n\n        // Connect and start playback\n        acquisitionState.playbackSource = audioContext.createBufferSource();\n        acquisitionState.playbackSource.buffer = audioBuffer;\n        acquisitionState.playbackSource.connect(sourceGain);\n        sourceGain.connect(audioContext.destination);\n        acquisitionState.playbackSource.start();\n\n        recordingStatusEl.textContent = `Playing sweep...`;\n        recordingStatusEl.style.color = '#0366d6';\n\n        playBtn.disabled = true;\n        stopPlayBtn.disabled = false;\n\n        setTimeout(() => {\n            stopPlayback();\n        }, (duration + 0.5) * 1000);\n\n    } catch (error) {\n        console.error('Error during playback:', error);\n        recordingStatusEl.textContent = `Error: ${(error as Error).message}`;\n        recordingStatusEl.style.color = '#d73a49';\n    }\n}\n\nfunction stopRecording(): void {\n    recordingStatusEl.textContent = 'Recording complete. Ready to analyze.';\n    recordingStatusEl.style.color = '#28a745';\n\n    // Update UI\n    startBtn.disabled = false;\n    stopBtn.disabled = true;\n    playBtn.disabled = false;\n    sweepStartFreqInput.disabled = false;\n    sweepEndFreqInput.disabled = false;\n    sweepDurationInput.disabled = false;\n\n    recordedAudioContainer.style.display = 'block';\n}\n\nfunction stopPlayback(): void {\n    if (acquisitionState.playbackSource) {\n        try {\n            acquisitionState.playbackSource.stop();\n        } catch (e) {\n            // Already stopped\n        }\n    }\n\n    recordingStatusEl.textContent = 'Playback stopped.';\n    playBtn.disabled = false;\n    stopPlayBtn.disabled = true;\n}\n\nconst measurementAngleInput = document.getElementById('measurementAngle') as HTMLInputElement;\nconst measurementLocationInput = document.getElementById('measurementLocation') as HTMLInputElement;\nconst measurementCommentInput = document.getElementById('measurementComment') as HTMLInputElement;\nconst downloadRecordingBtn = document.getElementById('downloadRecordingBtn') as HTMLButtonElement | null;\n\ndownloadRecordingBtn?.addEventListener('click', () => {\n    try {\n        download(recorded[0], 48000, 'recorded_audio.wav',\n            {},\n            convertToIXML(`\n        <ANGLE>${measurementAngleInput.value}</ANGLE>\n        <LOCATION>${measurementLocationInput.value}</LOCATION>\n        <COMMENT>${measurementCommentInput.value}</COMMENT>\n        <STIMULUS_TYPE>chirp</STIMULUS_TYPE>\n        <STIMULUS_START_FREQ>${sweepStartFreqInput.value}</STIMULUS_START_FREQ>\n        <STIMULUS_END_FREQ>${sweepEndFreqInput.value}</STIMULUS_END_FREQ>\n        <STIMULUS_DURATION>${sweepDurationInput.value}</STIMULUS_DURATION>\n        <STIMULUS_FADE>0.01</STIMULUS_FADE>\n        <STIMULUS_SAMPLE_RATE>48000</STIMULUS_SAMPLE_RATE>\n        <ORIGIN>Acquisition Module</ORIGIN>`));\n    } catch (err) {\n        console.error('Failed to create/download recording:', err);\n        alert('Failed to download recording: ' + (err as Error).message);\n    }\n});\n\nconst downloadSweepBtn = document.getElementById('downloadSweepBtn') as HTMLButtonElement | null;\n\ndownloadSweepBtn?.addEventListener('click', () => {\n    try {\n        download(recorded[0], 48000, 'reference_audio.wav',\n            {},\n            convertToIXML(`\n        <STIMULUS>\n            <TYPE>chirp</TYPE>\n            <START>${sweepStartFreqInput.value}</START>\n            <END>${sweepEndFreqInput.value}</END>\n            <FADE>0.01</FADE>\n            <DURATION>${sweepDurationInput.value}</DURATION>\n            <SAMPLE_RATE>48000</SAMPLE_RATE>\n        </STIMULUS>\n        <ORIGIN>Acquisition Module</ORIGIN>`));\n    } catch (err) {\n        console.error('Failed to create/download recording:', err);\n        alert('Failed to download recording: ' + (err as Error).message);\n    }\n});\n// Event listeners for acquisition controls\nstartBtn.addEventListener('click', startRecordingAndPlayback);\nstopBtn.addEventListener('click', stopRecording);\nplayBtn.addEventListener('click', playbackOnly);\nstopPlayBtn.addEventListener('click', stopPlayback);\n\nanalyzeRecordingBtn.addEventListener('click', async () => {\n    console.log('Analyzing recording...');\n\n    try {\n        const recordedAudio = Audio.fromSamples(recorded[0], 48000);\n\n        // Generate the chirp sweep as reference data\n        const startFreq = parseFloat(sweepStartFreqInput.value);\n        const endFreq = parseFloat(sweepEndFreqInput.value);\n        const duration = parseFloat(sweepDurationInput.value);\n\n        const [sweepSignal] = audio.chirp(startFreq, endFreq, duration);\n        const referenceAudio = Audio.fromSamples(sweepSignal, 48000);\n\n        // Add timestamp to recording name\n        const now = new Date();\n        const dateTime = now.toLocaleString('sv-SE', {\n            year: '2-digit',\n            month: '2-digit',\n            day: '2-digit',\n            hour: '2-digit',\n            minute: '2-digit',\n            second: '2-digit',\n            hour12: false\n        }).replace(',', '');\n        const recordingName = `${dateTime}`;\n\n        createAnalysisTab(\n            recordedAudio.applyGain(1 / 16384),\n            referenceAudio.applyGain(1 / 16384),\n            recordingName,\n            `${startFreq}-${endFreq}Hz`,\n        );\n        //\n\n    } catch (error) {\n        console.error('Error analyzing recording:', error);\n        alert('Error analyzing recording: ' + (error as Error).message);\n    }\n});\n\n// Save state when the user attempts to close or reload the window\nwindow.addEventListener('beforeunload', (e: BeforeUnloadEvent) => {\n    try {\n        saveState();\n    } catch (err) {\n        console.error('Failed to save state on beforeunload:', err);\n    }\n    // If you want to prompt the user to confirm leaving (browser-dependent), uncomment:\n    // e.preventDefault();\n    // e.returnValue = '';\n});\n\n// Tab switching\ntabsContainer.addEventListener('click', (e: MouseEvent) => {\n    const target = e.target as HTMLElement;\n\n    if (target.classList.contains('tab-close')) {\n        const tab = target.parentElement as HTMLElement;\n        const tabId = tab.dataset.tab;\n        if (tabId == 'upload') return;\n\n        console.debug('Closing tab', tabId);\n        tab.remove();\n        document.querySelector(`[data-content=\"${tabId}\"]`)?.remove();\n        storage.removeItem(`analysis-${tabId}`).catch(err => console.error('Failed to remove analysis from storage:', err));\n\n        // Activate upload tab if current was closed\n        if (tab.classList.contains('active')) {\n            switchTab('upload');\n        }\n        saveState();\n        e.stopPropagation();\n    } else if (target.classList.contains('tab')) {\n        const tabId = target.dataset.tab;\n        if (tabId) {\n            switchTab(tabId);\n        }\n    }\n});\n\nfunction switchTab(tabId: string): void {\n    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));\n    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));\n\n    document.querySelector(`[data-tab=\"${tabId}\"]`)?.classList.add('active');\n    document.querySelector(`[data-content=\"${tabId}\"]`)?.classList.add('active');\n}\n\n\nfunction compute(computation: Function, ...message: any[]): Promise<any> {\n    const delegate = () => {\n        onmessage = ({ data: { computation, message } }) => {\n            const wrapper = (fn: any) => Function('\"use strict\"; return (' + fn.toString() + ')')();\n            const result = wrapper(computation)(...message);\n            postMessage(result);\n        };\n    }\n    const functionBody = delegate.toString().replace(/^[^{]*{\\s*/, '').replace(/\\s*}[^}]*$/, '');\n    return new Promise((resolve, reject) => {\n        const worker = new Worker(URL.createObjectURL(\n            new Blob([functionBody], { type: 'text/javascript' })\n        ));\n        worker.onmessage = ({ data }) => {\n            resolve(data);\n            worker.terminate();\n        };\n        worker.onerror = worker.onmessageerror = reject;\n        worker.postMessage({ computation: computation.toString(), message });\n        return worker;\n    });\n}\n\n\nfunction createAnalysisTab(responseData: Audio, referenceData: Audio | null, filename: string, referenceFilename: string | null): void {\n    setStatusMessage('Creating analysis tab...');\n\n    tabCounter++;\n    const tabId = `analysis-${tabCounter}`;\n    let shortName = filename.length > 20 ? filename.substring(0, 17) + '...' : filename;\n    if (referenceFilename != null) {\n        const shortReferenceName = referenceFilename?.length > 20 ? referenceFilename.substring(0, 17) + '...' : referenceFilename;\n        shortName += ' / ' + shortReferenceName;\n    }\n    // Create tab button\n    const tab = document.createElement('button');\n    tab.className = 'tab tab-closable tab-loading';\n    tab.dataset.tab = tabId;\n    tab.innerHTML = `<span class=\"tab-icon-analysis\"></span>${shortName} <span class=\"tab-close\"></span>`;\n    tabsInnerContainer.appendChild(tab);\n\n    // Update HTML.\n    window.requestAnimationFrame(() => {\n        window.requestAnimationFrame(() => {\n\n            // Create tab content\n            const content = document.createElement('div');\n            content.className = 'tab-content';\n            content.dataset.content = tabId;\n            content.innerHTML = `\n    <!-- nav class=\"tab-menu-bar\">\n                <div>\n                    <label for=\"smoothing-${tabId}\">Smoothing</label>\n                    <select id=\"smoothing-${tabId}\" class=\"smoothing-select\" aria-label=\"Smoothing factor\">\n                        <option value=\"0\">None</option>\n                        <option value=\"1/3\">1/3 octave</option>\n                        <option value=\"1/6\" selected>1/6 octave</option>\n                        <option value=\"1/12\">1/12 octave</option>\n                        <option value=\"1/24\">1/24 octave</option>\n                        <option value=\"1/48\">1/48 octave</option>\n                    </select>\n                </div>\n            </nav> <h5 class=\"text-xs italic text-gray-600\">Frequency Response Analysis of ${filename}${referenceFilename ? ' / ' + referenceFilename : ''}</h5 -->\n        <button class=\"sidecar-toggle\" id=\"sidebar-toggle-${tabId}\" title=\"Toggle Sidecar\">Open settings pane</button>\n        <div class=\"flex h-full\">\n            <div class=\"flex-none w-86 border-r border-[#ddd] p-2 relative sidecar\" style=\"transition:50ms linear;\">\n                <div class=\"section\">\n                    <div class=\"title\">Settings</div>\n                    <p><i>There are no settings for this analysis.</i></p>\n                </div>\n                <div class=\"section\">\n                    <div class=\"title\">Plots</div>\n                    <ul class=\"list\" id=\"plot-list-${tabId}\">\n                        <!--li><input type=\"checkbox\" id=\"checkbox-magnitude-${tabId}\" alt=\"show/hide\" checked><label for=\"checkbox-magnitude-${tabId}\">Magnitude</label></li>\n                        <li><input type=\"checkbox\" id=\"checkbox-phase-${tabId}\" alt=\"show/hide\" checked><label for=\"checkbox-phase-${tabId}\">Phase</label></li>\n                        <li><input type=\"checkbox\" id=\"checkbox-ir-${tabId}\" alt=\"show/hide\" checked><label for=\"checkbox-ir-${tabId}\">Impulse Response</label></li>\n                        <li><input type=\"checkbox\" id=\"checkbox-ir-${tabId}\" alt=\"show/hide\" disabled><label for=\"checkbox-ir-${tabId}\">Fundamental + Harmonic Distortion</label></li>\n                        <li><input type=\"checkbox\" id=\"checkbox-distortion-${tabId}\" alt=\"show/hide\" disabled><label for=\"checkbox-distortion-${tabId}\">Distortion</label></li>\n                        <li><input type=\"checkbox\" id=\"checkbox-distortion-${tabId}\" alt=\"show/hide\" disabled><label for=\"checkbox-distortion-${tabId}\">Sound Pressure Level</label></li>\n                        <li><input type=\"checkbox\" id=\"checkbox-deconvoluted-ir-${tabId}\" alt=\"show/hide\" disabled><label for=\"checkbox-deconvoluted-ir-${tabId}\">Deconvoluted Impulse Response</label></li>\n                        <li><input type=\"checkbox\" id=\"checkbox-stimulus-waveform-${tabId}\" alt=\"show/hide\" disabled><label for=\"checkbox-stimulus-waveform-${tabId}\">Stimulus Waveform</label></li>\n                        <li><input type=\"checkbox\" id=\"checkbox-recorded-waveform-${tabId}\" alt=\"show/hide\" disabled><label for=\"checkbox-recorded-waveform-${tabId}\">Recorded Waveform</label></li>\n                        <li><input type=\"checkbox\" id=\"checkbox-recorded-noise-floor-${tabId}\" alt=\"show/hide\" disabled><label for=\"checkbox-recorded-noise-floor-${tabId}\">Recorded Noise Floor</label></li>\n                        <li><input type=\"checkbox\" id=\"checkbox-target-curve-${tabId}\" alt=\"show/hide\" disabled><label for=\"checkbox-target-curve-${tabId}\">Target Curve<button class=\"float-right text-xs cursor-pointer\" style=\"color: #bbb; padding-top: 3px\">Set</button></label></li-->\n                    </ul>\n                </div>\n                <div class=\"section\">\n                    <div class=\"title\">Properties</div>\n                    <p id=\"properties-${tabId}\"><i>There are no properties for this analysis.</i></p>\n                </div>\n                <div id=\"resize-handle\" class=\"resize-handle\"></div>\n            </div>\n            <div class=\"flex-1 main-content\">\n                <div class=\"grid grid-cols-6 gap-[1px] bg-[#ddd] border-b border-[#ddd] plot-outer\">\n                </div>\n            </div>\n        </div>\n\n\n    `;\n            tabContents.appendChild(content);\n\n            const propertiesElement = document.getElementById(`properties-${tabId}`);\n            if (propertiesElement) {\n                propertiesElement.innerHTML = `\n            <b>Filename:</b> ${filename}<br>\n            ${referenceFilename ? `<b>Reference Filename:</b> ${referenceFilename}<br>` : ''}\n            <b>Sample Rate:</b> ${responseData.sampleRate} Hz<br>\n            <b>Channels:</b> ${responseData.numberOfChannels}<br>\n            <b>Duration:</b> ${responseData.duration.toFixed(2)} s<br>\n            <b>RMS Level:</b> ${db(rms(responseData.getChannelData(0)))} dBFS<br>\n            <b>Peak Level:</b> ${db(max(responseData.getChannelData(0)))} dBFS<br>\n            <iXML Metadata:</i><br>\n            <pre>${(responseData.metadata?.iXMLdata || \"\" as any).replaceAll(\"<\", \"&lt;\").replaceAll(\">\", \"&gt;\")}</pre>\n            `;\n            }\n\n            const sidebarToggleBtn = document.getElementById(`sidebar-toggle-${tabId}`) as HTMLButtonElement;\n            const sidecar = content.querySelector('.sidecar') as HTMLElement;\n            const resizeHandle = content.querySelector('#resize-handle') as HTMLElement;\n\n            sidebarToggleBtn.addEventListener('click', () => {\n                if (sidecar.style.width === '0px') {\n                    sidecar.style.width = '21.5rem';\n                    sidebarToggleBtn.title = 'Close settings pane';\n                } else {\n                    sidecar.style.width = '0px';\n                    sidebarToggleBtn.title = 'Open settings pane';\n                }\n            });\n\n            let isResizing = false;\n            let lastDownX = 0;\n\n            resizeHandle.addEventListener('mousedown', (e: MouseEvent) => {\n                isResizing = true;\n                lastDownX = e.clientX;\n                document.body.style.cursor = 'ew-resize';\n                e.preventDefault();\n            });\n\n            document.addEventListener('mousemove', (e: MouseEvent) => {\n                if (!isResizing) return;\n                const offsetRight = tabsContainer.clientWidth - (e.clientX);\n                const newWidth = tabsContainer.clientWidth - offsetRight;\n                if (newWidth >= 200 && newWidth <= 600) {\n                    sidecar.style.width = `${newWidth}px`;\n                }\n                e.preventDefault();\n            });\n\n            document.addEventListener('mouseup', () => {\n                if (isResizing) {\n                    isResizing = false;\n                    document.body.style.cursor = 'default';\n                }\n            });\n\n            // Switch to new tab\n            switchTab(tabId);\n\n            // Compute and plot FFTs\n            const responseSamples = responseData.getChannelData(0);\n\n            const responseFFT = computeFFT(responseSamples);\n            const smoothedResponseFFT = smoothFFT(responseFFT, 1 / 6, 1 / 48);\n\n            let referenceSamples = Float32Array.from([]);\n\n            plot(\n                [\n                    { x: responseFFT.frequency, y: db(responseFFT.magnitude), name: 'Recorded signal', line: { color: '#0366d666', width: 0.75 } },\n                    { x: smoothedResponseFFT.frequency, y: db(smoothedResponseFFT.magnitude), name: 'Recorded signal (Smoothed)', line: { color: '#0366d6', width: 1.5 } }\n                ],\n                tabId,\n                'Recorded Spectrum',\n                'Frequency (Hz)',\n                'Amplitude (dBFS)',\n                { type: 'log', range: [Math.log10(20), Math.log10(20000)] },\n                { range: [-85, 5] },\n                {},\n                true\n            );\n            plot(\n                [\n                    { x: linspace(0, responseSamples.length / 48000, responseSamples.length), y: responseSamples, name: 'Recorded signal', line: { color: '#0366d6ff', width: 0.75 } }\n                ],\n                tabId,\n                'Recorded Waveform',\n                'Time (s)',\n                'Amplitude',\n                {},\n                {},\n                {},\n                true\n            );\n\n            setStatusMessage('');\n\n            if (referenceData) {\n                referenceSamples = referenceData.getChannelData(0);\n                const referenceFFT: FFTResult = computeFFT(referenceSamples);\n                const smoothedReferenceFFT = smoothFFT(referenceFFT, 1 / 6, 1 / 48);\n                plot(\n                    [\n                        { x: referenceFFT.frequency, y: db(referenceFFT.magnitude), name: 'Stimulus signal', line: { color: '#0366d666', width: 0.75 } },\n                        { x: smoothedReferenceFFT.frequency, y: db(smoothedReferenceFFT.magnitude), name: 'Stimulus signal (Smoothed)', line: { color: '#0366d6', width: 1.5 } }\n                    ],\n                    tabId,\n                    'Stimulus Spectrum',\n                    'Frequency (Hz)',\n                    'Amplitude (dBFS)',\n                    { type: 'log', range: [Math.log10(20), Math.log10(20000)] },\n                    { range: [-85, 5] },\n                    {},\n                    true\n                );\n                plot(\n                    [\n                        { x: linspace(0, referenceSamples.length / 48000, referenceSamples.length), y: referenceSamples, name: 'Stimulus signal', line: { color: '#0366d6ff', width: 0.75 } }\n                    ],\n                    tabId,\n                    'Stimulus Waveform',\n                    'Time (s)',\n                    'Amplitude',\n                    {},\n                    {},\n                    {},\n                    true\n                );\n                const ir: ImpulseResponseResult = twoChannelImpulseResponse(responseSamples, referenceSamples);\n                const farina = new Farina(referenceSamples, 20, 20000, 48000);\n                const farina_ir: ImpulseResponseResult = farina.deconvolvedResponse(responseSamples);\n\n                plotDistortion(farina, 0.1, 5, tabId);\n                plotTHD(farina, 0.1, 5, tabId);\n\n                console.log('Impulse response peak at', farina.lag_of_harmonic(2));\n\n                plot(\n                    [\n                        { x: ir.t, y: ir.ir, type: 'scatter', mode: 'lines', name: 'Dual-FFT Impulse Response', line: { color: COLORS[0], width: 0.75 } }\n                    ],\n                    tabId,\n                    'Impulse Response',\n                    'Time (s)',\n                    'Amplitude',\n                    {},\n                    {},\n                    {},\n                    false\n                );\n\n                plot(\n                    [\n                        { x: [-max(farina_ir.t), max(farina_ir.t)], y: [-200, -200], showlegend: false },\n                        { x: farina_ir.t, y: db(farina_ir.ir.map(x => Math.abs(x))), type: 'scatter', mode: 'lines', fill: 'tonexty', name: 'Farina Impulse Response', line: { color: COLORS[0], width: 0.75 }, fillcolor: COLORS[0] },\n                        { x: [- 0.05, - 0.05], y: [-999, 999], type: 'scatter', mode: 'lines', name: 'Fundamental window start', line: { color: '#00000033', width: 0.75 }, hoverinfo: 'skip', showlegend: false },\n                        { x: [0.05, 0.05], y: [-999, 999], type: 'scatter', mode: 'lines', name: 'Fundamental window end', line: { color: '#00000033', width: 0.75 }, hoverinfo: 'skip', showlegend: false },\n                        { x: [-farina.lag_of_harmonic(2) - 0.05, -farina.lag_of_harmonic(2) - 0.05], y: [-999, 999], type: 'scatter', mode: 'lines', name: 'H2 window start', line: { color: '#00000033', width: 0.75 }, hoverinfo: 'skip', showlegend: false },\n                        { x: [-farina.lag_of_harmonic(2) + 0.05, -farina.lag_of_harmonic(2) + 0.05], y: [-999, 999], type: 'scatter', mode: 'lines', name: 'H2 window end', line: { color: '#00000033', width: 0.75 }, hoverinfo: 'skip', showlegend: false },\n                        { x: [-farina.lag_of_harmonic(3) - 0.05, -farina.lag_of_harmonic(3) - 0.05], y: [-999, 999], type: 'scatter', mode: 'lines', name: 'H3 window start', line: { color: '#00000033', width: 0.75 }, hoverinfo: 'skip', showlegend: false },\n                        { x: [-farina.lag_of_harmonic(3) + 0.05, -farina.lag_of_harmonic(3) + 0.05], y: [-999, 999], type: 'scatter', mode: 'lines', name: 'H3 window end', line: { color: '#00000033', width: 0.75 }, hoverinfo: 'skip', showlegend: false },\n                        { x: [-farina.lag_of_harmonic(4) - 0.05, -farina.lag_of_harmonic(4) - 0.05], y: [-999, 999], type: 'scatter', mode: 'lines', name: 'H4 window start', line: { color: '#00000033', width: 0.75 }, hoverinfo: 'skip', showlegend: false },\n                        { x: [-farina.lag_of_harmonic(4) + 0.05, -farina.lag_of_harmonic(4) + 0.05], y: [-999, 999], type: 'scatter', mode: 'lines', name: 'H4 window end', line: { color: '#00000033', width: 0.75 }, hoverinfo: 'skip', showlegend: false },\n                        { x: [-farina.lag_of_harmonic(5) - 0.05, -farina.lag_of_harmonic(5) - 0.05], y: [-999, 999], type: 'scatter', mode: 'lines', name: 'H5 window start', line: { color: '#00000033', width: 0.75 }, hoverinfo: 'skip', showlegend: false },\n                        { x: [-farina.lag_of_harmonic(5) + 0.05, -farina.lag_of_harmonic(5) + 0.05], y: [-999, 999], type: 'scatter', mode: 'lines', name: 'H5 window end', line: { color: '#00000033', width: 0.75 }, hoverinfo: 'skip', showlegend: false },\n                        { x: [-farina.lag_of_harmonic(6) - 0.05, -farina.lag_of_harmonic(6) - 0.05], y: [-999, 999], type: 'scatter', mode: 'lines', name: 'H6 window start', line: { color: '#00000033', width: 0.75 }, hoverinfo: 'skip', showlegend: false },\n                        { x: [-farina.lag_of_harmonic(6) + 0.05, -farina.lag_of_harmonic(6) + 0.05], y: [-999, 999], type: 'scatter', mode: 'lines', name: 'H6 window end', line: { color: '#00000033', width: 0.75 }, hoverinfo: 'skip', showlegend: false },\n                        { x: [-farina.lag_of_harmonic(7) - 0.05, -farina.lag_of_harmonic(7) - 0.05], y: [-999, 999], type: 'scatter', mode: 'lines', name: 'H7 window start', line: { color: '#00000033', width: 0.75 }, hoverinfo: 'skip', showlegend: false },\n                        { x: [-farina.lag_of_harmonic(7) + 0.05, -farina.lag_of_harmonic(7) + 0.05], y: [-999, 999], type: 'scatter', mode: 'lines', name: 'H7 window end', line: { color: '#00000033', width: 0.75 }, hoverinfo: 'skip', showlegend: false },\n\n                    ],\n                    tabId,\n                    'Deconvolved Response',\n                    'Time (s)',\n                    'Amplitude',\n                    { range: [-1, 1] },\n                    { range: [-150, 10] },\n                    {},\n                    false\n                );\n                const transferFunction = computeFFTFromIR(ir);\n                // const dreferenceFFT = twoChannelFFT(responseData.data, referenceSamples, nextPow2(referenceSamples.length), -5627);\n                const smoothedFreqResponse = smoothFFT(transferFunction, 1 / 6, 1 / 48);\n\n                const gd = groupDelays(transferFunction, 1000);\n\n                plot(\n                    [\n                        { x: transferFunction.frequency, y: db(transferFunction.magnitude), name: 'Magnitude', line: { color: '#0366d666', width: 0.75 } },\n                        { x: smoothedFreqResponse.frequency, y: db(smoothedFreqResponse.magnitude), name: 'Magnitude (Smoothed)', line: { color: '#0366d6', width: 1.5 } }\n                    ],\n                    tabId,\n                    'Transfer Function',\n                    'Frequency (Hz)',\n                    'Amplitude (dBFS)',\n                    { type: 'log', range: [Math.log10(20), Math.log10(20000)] },\n                    { range: [-85, 5] },\n                    {},\n                    false\n                );\n\n                plot(\n                    [\n                        { x: transferFunction.frequency, y: transferFunction.phase, name: 'Phase', line: { color: '#0366d666', width: 0.75 } },\n                        { x: smoothedFreqResponse.frequency, y: smoothedFreqResponse.phase, name: 'Phase (Smoothed)', line: { color: '#0366d6', width: 1.5 } }\n                    ],\n                    tabId,\n                    'Phase',\n                    'Frequency (Hz)',\n                    'Amplitude (dBFS)',\n                    { type: 'log', range: [Math.log10(20), Math.log10(20000)] },\n                    { range: [-720, 720] },\n                    {},\n                    false\n                );\n                plot(\n                    [\n                        { x: transferFunction.frequency, y: gd, name: 'Group Delay', line: { color: COLORS[0], width: 1.5, dash: 'dot' } }\n                    ],\n                    tabId,\n                    'Group Delay',\n                    'Frequency (Hz)',\n                    'Group Delay (ms)',\n                    { type: 'log', range: [Math.log10(20), Math.log10(20000)] },\n                    { range: [-20, 20] },\n                    {},\n                    false\n                );\n\n                // --- Colormap / Spectrogram (Plotly heatmap) ---\n                (() => {\n                    const sr =\n                        (responseData as any).sampleRate ??\n                        (referenceData as any)?.sampleRate ??\n                        48000;\n\n                    const n = responseSamples.length;\n                    if (n < 4096) return;\n\n                    const windowSize = 2048;\n                    const targetFrames = 320;\n                    const minHop = 256;\n\n                    const rawFrames = Math.max(1, Math.floor((n - windowSize) / minHop) + 1);\n                    const hop =\n                        rawFrames > targetFrames\n                            ? Math.max(minHop, Math.ceil((n - windowSize) / targetFrames))\n                            : minHop;\n\n                    const frames = Math.max(1, Math.floor((n - windowSize) / hop) + 1);\n\n                    // Hann window\n                    const win = new Float32Array(windowSize);\n                    for (let i = 0; i < windowSize; i++) {\n                        win[i] = 0.5 * (1 - Math.cos((2 * Math.PI * i) / (windowSize - 1)));\n                    }\n\n                    // Determine frequency bins from first frame\n                    const firstFrame = new Float32Array(windowSize);\n                    firstFrame.set(responseSamples.subarray(0, windowSize));\n                    for (let i = 0; i < windowSize; i++) firstFrame[i] *= win[i];\n\n                    const firstFFT = computeFFT(firstFrame);\n                    const freqs = Array.from(firstFFT.frequency);\n                    const bins = freqs.length;\n\n                    // z[freqIndex][timeIndex]\n                    const z: number[][] = Array.from({ length: bins }, () => []);\n\n                    const times: number[] = [];\n                    for (let frame = 0; frame < frames; frame++) {\n                        const start = frame * hop;\n                        const slice = responseSamples.subarray(start, start + windowSize);\n\n                        const windowed = new Float32Array(windowSize);\n                        windowed.set(slice);\n                        for (let i = 0; i < windowSize; i++) windowed[i] *= win[i];\n\n                        const fft = computeFFT(windowed);\n                        const magDb = db(fft.magnitude);\n\n                        for (let k = 0; k < bins; k++) {\n                            z[k].push(magDb[k]);\n                        }\n\n                        // Use center-of-window time for x axis\n                        times.push((start + windowSize / 2) / sr);\n                    }\n\n                    plot(\n                        [\n                            {\n                                type: 'heatmap',\n                                x: times,\n                                y: freqs,\n                                z,\n                                colorscale: 'Electric',\n                                zmin: -120,\n                                zmax: 0,\n                                colorbar: { title: 'dBFS' }\n                            } as any\n                        ],\n                        tabId,\n                        'Recorded Spectrogram',\n                        'Time (s)',\n                        'Frequency (Hz)',\n                        {},\n                        { type: 'log', range: [Math.log10(20), Math.log10(20000)] },\n                        { margin: { l: 60, r: 20, t: 40, b: 50 } },\n                        false\n                    );\n                })();\n            }\n\n            saveState();\n\n            // Persist analysis using IndexedDB (mirrored to sessionStorage for compatibility)\n            storage.setItem(`${tabId}`, JSON.stringify({\n                filename,\n                referenceFilename,\n                responseSamples: Array.from(responseSamples),\n                referenceSamples: referenceSamples.length > 0 ? Array.from(referenceSamples) : null,\n            })).catch(err => console.error('Failed to persist analysis:', err));\n\n            function initResize(e: MouseEvent): void {\n                e.preventDefault();\n                window.addEventListener('mousemove', resize, false);\n                window.addEventListener('mouseup', stopResize, false);\n                console.log('Init resize');\n                document.body.style.cursor = 'col-resize';\n            }\n\n            function resize(e: MouseEvent): void {\n                const container = content.querySelector<HTMLElement>('.flex')!;\n                const handle = document.getElementById('resize-handle')?.parentElement!;\n                const rect = container.getBoundingClientRect();\n                const newWidth = e.clientX - rect.left;\n                if (newWidth > 150 && newWidth < rect.width - 150) {\n                    handle.style.width = `${newWidth}px`;\n                }\n            }\n\n            function stopResize(): void {\n                window.removeEventListener('mousemove', resize, false);\n                window.removeEventListener('mouseup', stopResize, false);\n                window.dispatchEvent(new Event('resize'));\n                document.body.style.cursor = 'default';\n            }\n\n            document.getElementById('resize-handle')?.addEventListener('mousedown', initResize, false);\n\n            tab.classList.remove('tab-loading');\n\n        });\n    });\n}\n\n\nfunction createDirectivityPlotTab(responseDatas: Audio[], referenceData: Audio, anglesDeg?: number[]): void {\n    console.log('Creating directivity plot tab with', responseDatas.length, 'responses and reference data', referenceData);\n    if (responseDatas.length === 0 || referenceData.length === 0) return;\n\n    tabCounter++;\n    const tabId = `directivity-${tabCounter}`;\n    const shortName = `Directivity (${responseDatas.length})`;\n\n    const tab = document.createElement('button');\n    tab.className = 'tab tab-closable tab-loading';\n    tab.dataset.tab = tabId;\n    tab.innerHTML = `<span class=\"tab-icon-analysis\"></span>${shortName} <span class=\"tab-close\"></span>`;\n    tabsInnerContainer.appendChild(tab);\n\n\n    // Create tab content\n    const content = document.createElement('div');\n    content.className = 'tab-content';\n    content.dataset.content = tabId;\n    content.innerHTML = `\n        <button class=\"sidecar-toggle\" id=\"sidebar-toggle-${tabId}\" title=\"Toggle Sidecar\">Open settings pane</button>\n        <div class=\"flex h-full\">\n            <div class=\"flex-none w-86 border-r border-[#ddd] p-2 relative sidecar\" style=\"transition:50ms linear;\">\n                <div class=\"section\">\n                    <div class=\"title\">Settings</div>\n                    <p><i>There are no settings for this analysis.</i></p>\n                </div>\n                <div class=\"section\">\n                    <div class=\"title\">Plots</div>\n                    <ul class=\"list\" id=\"plot-list-${tabId}\">\n                        <!--li><input type=\"checkbox\" id=\"checkbox-magnitude-${tabId}\" alt=\"show/hide\" checked><label for=\"checkbox-magnitude-${tabId}\">Magnitude</label></li>\n                        <li><input type=\"checkbox\" id=\"checkbox-phase-${tabId}\" alt=\"show/hide\" checked><label for=\"checkbox-phase-${tabId}\">Phase</label></li>\n                        <li><input type=\"checkbox\" id=\"checkbox-ir-${tabId}\" alt=\"show/hide\" checked><label for=\"checkbox-ir-${tabId}\">Impulse Response</label></li>\n                        <li><input type=\"checkbox\" id=\"checkbox-ir-${tabId}\" alt=\"show/hide\" disabled><label for=\"checkbox-ir-${tabId}\">Fundamental + Harmonic Distortion</label></li>\n                        <li><input type=\"checkbox\" id=\"checkbox-distortion-${tabId}\" alt=\"show/hide\" disabled><label for=\"checkbox-distortion-${tabId}\">Distortion</label></li>\n                        <li><input type=\"checkbox\" id=\"checkbox-distortion-${tabId}\" alt=\"show/hide\" disabled><label for=\"checkbox-distortion-${tabId}\">Sound Pressure Level</label></li>\n                        <li><input type=\"checkbox\" id=\"checkbox-deconvoluted-ir-${tabId}\" alt=\"show/hide\" disabled><label for=\"checkbox-deconvoluted-ir-${tabId}\">Deconvoluted Impulse Response</label></li>\n                        <li><input type=\"checkbox\" id=\"checkbox-stimulus-waveform-${tabId}\" alt=\"show/hide\" disabled><label for=\"checkbox-stimulus-waveform-${tabId}\">Stimulus Waveform</label></li>\n                        <li><input type=\"checkbox\" id=\"checkbox-recorded-waveform-${tabId}\" alt=\"show/hide\" disabled><label for=\"checkbox-recorded-waveform-${tabId}\">Recorded Waveform</label></li>\n                        <li><input type=\"checkbox\" id=\"checkbox-recorded-noise-floor-${tabId}\" alt=\"show/hide\" disabled><label for=\"checkbox-recorded-noise-floor-${tabId}\">Recorded Noise Floor</label></li>\n                        <li><input type=\"checkbox\" id=\"checkbox-target-curve-${tabId}\" alt=\"show/hide\" disabled><label for=\"checkbox-target-curve-${tabId}\">Target Curve<button class=\"float-right text-xs cursor-pointer\" style=\"color: #bbb; padding-top: 3px\">Set</button></label></li-->\n                    </ul>\n                </div>\n                <div class=\"section\">\n                    <div class=\"title\">Properties</div>\n                    <p id=\"properties-${tabId}\"><i>There are no properties for this analysis.</i></p>\n                </div>\n                <div id=\"resize-handle\" class=\"resize-handle\"></div>\n            </div>\n            <div class=\"flex-1 main-content\">\n                <div class=\"grid grid-cols-6 gap-[1px] bg-[#ddd] border-b border-[#ddd] plot-outer\">\n                </div>\n            </div>\n        </div>\n\n\n    `;\n    tabContents.appendChild(content);\n\n    window.requestAnimationFrame(() => {\n        window.requestAnimationFrame(() => {\n\n            //switchTab(tabId);\n\n            const startTime = performance.now()\n\n            const useCustomAngles = !!anglesDeg && anglesDeg.length === responseDatas.length;\n            const angles = useCustomAngles\n                ? anglesDeg!.map(normalizeAngleDeg)\n                : responseDatas.map((_, i) => (360 * i) / responseDatas.length);\n\n            const referenceSamples = Float32Array.from(referenceData.getChannelData(0));\n\n            const len = Math.min(7.5 * 48000, referenceSamples.length);\n            const referenceFFT = updatedFFT(referenceSamples.subarray(0, len), len);\n\n            const calcStartTime = performance.now()\n            const transfers: FFTResult[] = [];\n            const smoothTransfers: FFTResult[] = [];\n            for (let i = 0; i < responseDatas.length; i++) {\n                const resp = responseDatas[i];\n                const loopStartTime = performance.now()\n                const fftr = twoChannelFFT(\n                    resp.getChannelData(0).subarray(0, len),\n                    referenceSamples.subarray(0, len),\n                    nextPow2(len),\n                    0,\n                    referenceFFT,\n                );\n                //\n                fftr.magnitude = fftr.magnitude.map((v, i) => Math.abs(v));\n\n                const ffto = smoothFFT(fftr, 1 / 3, 1 / 48);\n                smoothTransfers.push(ffto);\n                transfers.push(fftr);\n            }\n            const calcEndTime = performance.now()\n            console.warn(`CALC TOOK ${calcEndTime - calcStartTime} milliseconds`)\n\n\n            const baseFreq = transfers[0]?.frequency;\n            if (!baseFreq || baseFreq.length === 0) return;\n\n            const normHz = 1000;\n            let normIdx = 0;\n            let best = Number.POSITIVE_INFINITY;\n            for (let i = 0; i < baseFreq.length; i++) {\n                const d = Math.abs(baseFreq[i] - normHz);\n                if (d < best) {\n                    best = d;\n                    normIdx = i;\n                }\n            }\n\n            transfers.push(transfers[0]); // close the circle\n            angles.push(360); // close the circle\n\n            // cycle array by 16 indices to center front at 0 deg\n            const cycleBy = 18;\n            const cycleTransfers = smoothTransfers.slice(cycleBy).concat(smoothTransfers.slice(0, cycleBy));\n\n\n            const asngles = angles.map(a => a - 180);\n\n            // z[angleIndex][freqIndex]\n            const z: any = cycleTransfers.map((tf) => {\n                const magDb = db(tf.magnitude);\n                return magDb.map((v, i) => v - db(smoothTransfers[0].magnitude)[i]);\n            });\n\n\n            const endTime = performance.now()\n\n            console.warn(`TOOK ${endTime - startTime} milliseconds`)\n\n            plot(\n                [\n                    {\n                        type: 'heatmap',\n                        x: smoothTransfers[0].frequency,\n                        y: asngles,\n                        z,\n                        colorscale: 'Portland',\n                        zmin: -24,\n                        contours: { coloring: '#fff', showlines: true, start: -36, end: 0, size: 6 },\n                        zmax: 6,\n                        zsmooth: 'best',\n                        colorbar: { title: 'dB (norm @ 1 kHz)' }\n                    } as any\n                ],\n                tabId,\n                'Directivity Map',\n                'Frequency (Hz)',\n                'Angle (deg)',\n                { type: 'log', range: [Math.log10(20), Math.log10(20000)] },\n                { range: [-180, 180] },\n                { margin: { l: 60, r: 20, t: 40, b: 50 } },\n                false\n            );\n\n            // Calculate the average response.\n            const avgMagnitude = new Float32Array(baseFreq.length);\n            for (let i = 0; i < baseFreq.length; i++) {\n                let sum = 0;\n                for (let j = 0; j < transfers.length - 1; j++) {\n                    sum += transfers[j].magnitude[i];\n                }\n                avgMagnitude[i] = sum / (transfers.length - 1);\n            }\n\n            const smoothAvgMagnitude = smoothFFT({ frequency: baseFreq, magnitude: avgMagnitude, phase: new Float32Array(baseFreq.length), fftSize: nextPow2(baseFreq.length) }, 1 / 6, 1 / 48);\n            const on = smoothFFT(transfers[0], 1 / 6, 1 / 48);\n\n            const anglesToPlot = [0, 30, 60, 90, 180];\n\n            plot(\n                [\n                    ...anglesToPlot.map((angle, i) => {\n                        const idx = angles.findIndex(a => Math.abs(a - angle) < 0.1);\n                        if (idx === -1) {\n                            return null;\n                        }\n                        return { x: smoothFFT(transfers[idx], 1 / 6, 1 / 48).frequency, y: db(smoothFFT(transfers[idx], 1 / 6, 1 / 48).magnitude), name: `${angle} deg response`, line: { width: 1.5, color: COLORS[i] } };\n                    }),\n                    { x: smoothAvgMagnitude.frequency, y: db(smoothAvgMagnitude.magnitude), name: 'Average Response', line: { width: 2, color: '#000000' } },\n\n                ],\n                tabId,\n                'Transfer Function',\n                'Frequency (Hz)',\n                'Amplitude (dB)',\n                { type: 'log', range: [Math.log10(20), Math.log10(20000)] },\n                { range: [-85, 5] },\n                {},\n                false\n            );\n\n            // Plot directivity index.\n            plot(\n                [\n                    { x: on.frequency, y: db(smoothAvgMagnitude.magnitude).map((v, i) => db(on.magnitude)[i] - v), name: 'Average Response', line: { width: 2, color: '#000000' } },\n                ],\n                tabId,\n                'Directivity Index',\n                'Frequency (Hz)',\n                'DI (dB)',\n                { type: 'log', range: [Math.log10(20), Math.log10(20000)] },\n                { range: [-10, 50] },\n                {},\n                false\n            );\n\n            // Polar directivity plots (add several frequency slices)\n            (() => {\n                const freqsToPlot = [62.5, 125, 250, 500, 1_000, 2_000, 4_000, 8_000, 16_000];\n                const uniqueTransfers = smoothTransfers; // last entry is duplicate to close circle\n                const uniqueAngles = angles;\n\n                const traces: any[] = [];\n                const aseFreq = uniqueTransfers[0].frequency;\n\n                for (let fi = 0; fi < freqsToPlot.length; fi++) {\n                    const hz = freqsToPlot[fi];\n                    // find nearest frequency index\n                    let idx = 0;\n                    let best = Number.POSITIVE_INFINITY;\n                    for (let i = 0; i < aseFreq.length; i++) {\n                        const d = Math.abs(aseFreq[i] - hz);\n                        if (d < best) {\n                            best = d;\n                            idx = i;\n                        }\n                    }\n\n                    // collect magnitude (dB) across angles\n                    const magDb = uniqueTransfers.map(tf => db(tf.magnitude)[idx] ?? -999);\n                    // normalize so max = 0 dB\n                    const maxVal = Math.max(...magDb);\n                    const r = magDb.map(v => v - maxVal);\n\n                    // close the loop for polar plot\n                    const theta = [...uniqueAngles, 360];\n                    const rClosed = [...r];\n\n                    traces.push({\n                        type: 'scatterpolar',\n                        r: rClosed,\n                        theta,\n                        mode: 'lines+markers',\n                        name: `${hz} Hz`,\n                        line: { color: COLORS[fi % COLORS.length], width: 2 },\n                        marker: { size: 4 }\n                    });\n                }\n\n                plot(\n                    traces,\n                    tabId,\n                    'Polar Directivity',\n                    'Frequency (Hz)',\n                    'Angle (deg)',\n                    {}, // x-axis options unused for polar\n                    {}, // y-axis options unused for polar\n                    {\n                        polar: {\n                            radialaxis: { title: { text: 'Relative dB (max = 0 dB)' }, angle: 90, dtick: 10, range: [-50, 0] },\n                            angularaxis: { direction: 'clockwise', rotation: 90, tickmode: 'array' }\n                        },\n                        margin: { l: 60, r: 20, t: 40, b: 50 }\n                    },\n                    false\n                );\n            })();\n\n\n            tab.classList.remove('tab-loading');\n        });\n    });\n}\n\n// Save and load state from sessionStorage\nfunction saveState(): void {\n    const tabs = Array.from(document.querySelectorAll('.tab[data-tab]')).map(tab => ({\n        id: (tab as HTMLElement).dataset.tab,\n        name: (tab as HTMLElement).textContent?.replace('', '').trim()\n    }));\n\n    storage.setItem('tabs', JSON.stringify(tabs));\n    console.log('Saved state with tabs:', tabs);\n}\n\nasync function loadState(): Promise<void> {\n    try {\n        const savedTabs = await storage.getItem('tabs');\n        if (!savedTabs) return;\n        const tabs = JSON.parse(savedTabs);\n        console.log('Loading saved tabs:', tabs);\n\n        for (const tab of tabs as { id: string; name: string }[]) {\n            // Call createAnalysisTab for each tab\n            const raw = await storage.getItem(`${tab.id}`);\n            const analysisData = raw ? JSON.parse(raw) : null;\n            console.log('Restoring analysis data for tab', tab.id, analysisData);\n            if (analysisData) {\n                createAnalysisTab(Audio.fromSamples(Float32Array.from(analysisData.responseSamples)), analysisData.referenceSamples ? Audio.fromSamples(Float32Array.from(analysisData.referenceSamples)) : null, analysisData.filename, analysisData.referenceFilename);\n            }\n        }\n        // Tabs will be recreated when user analyzes files again\n    } catch (e) {\n        console.error('Failed to load saved state:', e);\n    }\n}\n\nfunction normalizesAngleDeg(angle: number): number {\n    let a = angle % 360;\n    if (a < 0) a += 360;\n    return a;\n}\n\nasync function loadTestPolarData(): Promise<void> {\n    // Load some test data for polar analysis\n    const angles = [\n        0, 10, 20, 30, 40, 50, 60, 70, 80,\n        90, 100, 110, 120, 130, 140, 150, 160, 170,\n        180, 190, 200, 210, 220, 230, 240, 250, 260,\n        270, 280, 290, 300, 310, 320, 330, 340, 350];\n\n    const files = angles.map(a => `testdata/${a}.wav`);\n    createDirectivityPlotTab(\n        await Promise.all(files.map(f => loadAudioFromFilename(f))),\n        await loadAudioFromFilename('testdata/sweep_signal.wav.wav'),\n        angles\n    );\n}\n\nasync function loadWaveformsFromStorage(): Promise<Map<string, Audio>> {\n    // Load waveforms from IndexedDB (mirrored to sessionStorage for compatibility)\n    try {\n        const raw = await storage.getItem('waveforms');\n        console.log('Attempting:', raw);\n\n        const items: Map<string, Audio> = new Map();\n        const decoded = JSON.parse(raw || '[]');\n        console.log('Decoded waveforms from storage:', decoded);\n\n        const startLoadTime = performance.now();\n        for (const item of decoded) {\n            // Convert numeric arrays back to typed arrays so Audio.fromObject gets proper buffers.\n            if (item.data && Array.isArray(item.data)) {\n                item.data = Float32Array.from(item.data);\n            }\n            if (item.channelData && Array.isArray(item.channelData)) {\n                item.channelData = item.channelData.map((ch: any) => Array.isArray(ch) ? Float32Array.from(ch) : ch);\n            }\n            if (item.samples && Array.isArray(item.samples)) {\n                item.samples = Float32Array.from(item.samples);\n            }\n            items.set(item.id, Audio.fromObject(item));\n        }\n        console.log(`Loaded ${items.size} waveforms from storage in ${performance.now() - startLoadTime} milliseconds`);\n        console.log('Loaded waveforms from storage:', items);\n\n        return items;\n    } catch (err) {\n        console.warn('Failed to load waveforms from storage:', err);\n        return new Map();\n    }\n}\n\nfunction saveWaveformsToStorage(waveforms: Map<string, Audio>): void {\n    // Save waveforms to IndexedDB (mirrored to sessionStorage for compatibility)\n    console.warn('Saving waveforms to storage:', waveforms);\n    const toSave = Array.from(waveforms.entries()).map(([id, wf]) => {\n        const obj = wf.toObject();\n        obj.id = id;\n        return obj;\n    });\n    storage.setItem('waveforms', JSON.stringify(toSave)).catch(err => {\n        console.error('Failed to save waveforms to storage:', err);\n    });\n}\n\nfunction createListItem(audioObject: Audio, id: string): HTMLLIElement {\n    const li = document.createElement('li');\n    li.dataset.id = id;\n    li.style.display = 'flex';\n    li.classList.add('file-list-item');\n    li.innerHTML = `\n        <div style=\"flex:1;min-width:0;\">\n            <div style=\"font-weight:600;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;\">${audioObject.metadata?.filename || 'Unknown'}</div>\n            <div style=\"font-size:12px;color:#666;\">${audioObject.metadata?.mime || 'audio/*'}</div>\n            <div style=\"font-size:12px;color:#666;\">Duration: ${audioObject.duration.toFixed(2)} seconds</div>\n            <div style=\"font-size:12px;color:#666;\">Angle: ${audioObject?.metadata?.iXML?.angle ?? 'N/A'} deg</div>\n            <div style=\"font-size:12px;color:#666;\">Origin: ${audioObject?.metadata?.iXML?.origin ?? 'Imported'}</div>\n        </div>\n        <div class=\"file-list-item-controls flex:1;min-width:0;\">\n            <div><label style=\"font-size:13px;\"><input type=\"radio\" name=\"selectedResponse\" value=\"${id}\"> Response</label></div>\n            <div><label style=\"font-size:13px;\"><input type=\"radio\" name=\"selectedReference\" value=\"${id}\"> Reference</label></div>\n            <div><button type=\"button\" data-action=\"remove\" style=\"margin-left:8px;\">Remove</button></div>\n        </div>\n    `;\n\n    // Insert image generated by Audio.getEnvelopeImage()\n    const bas = audioObject.getEnvelopeImage(0, 1000, 100)\n    li.style.backgroundImage = `url(${bas})`;\n    li.style.backgroundRepeat = 'no-repeat';\n    li.style.backgroundPosition = 'center center';\n    li.style.backgroundSize = 'fill';\n\n    return li;\n}\n\nfunction updateAnalyzeState() {\n    const responseSelected = !!document.querySelector('input[name=\"selectedResponse\"]:checked');\n    const referenceSelected = !!document.querySelector('input[name=\"selectedReference\"]:checked');\n    const analyzeBtn = document.getElementById('analyzeUploadBtn') as HTMLButtonElement;\n    if (responseSelected) {\n        analyzeBtn.disabled = false;\n    } else {\n        analyzeBtn.disabled = true;\n    }\n}\n\nasync function addFilesFromInput(fileList: FileList) {\n    await Promise.all(Array.from(fileList).map(async f => {\n        const id = `${Date.now().toString(36)}-${Math.random().toString(36).slice(2, 8)}`;\n        const a = await audio.loadAudioFile(f);\n        fileMap.set(id, a);\n        console.log('Added file:', id, a);\n        console.log('Current file map:', fileMap);\n        const li = createListItem(a, id);\n        document.getElementById('fileList')?.appendChild(li);\n    })).then(() => {\n        console.log('All files added. Current file map:', fileMap);\n        saveWaveformsToStorage(fileMap);\n    });\n    updateAnalyzeState();\n}\n\ndocument.addEventListener('DOMContentLoaded', () => {\n    const respInput = document.getElementById('responseFileUpload');\n    const refInput = document.getElementById('referenceFileUpload'); // exists below\n    if (respInput) respInput.addEventListener('change', e => {\n        if (e?.target?.files?.length) addFilesFromInput(e.target.files);\n        e.target.value = '';\n    });\n\n    document.getElementById('fileList').addEventListener('click', e => {\n        const li = e.target.closest('li');\n        if (!li) return;\n        const id = li.dataset.id;\n        if (e.target.matches('button[data-action=\"remove\"]')) {\n            // remove\n            // if removed file was chosen in underlying file inputs, clear radios\n            const responseRadio = document.querySelector(`input[name=\"selectedResponse\"][value=\"${id}\"]`);\n            const referenceRadio = document.querySelector(`input[name=\"selectedReference\"][value=\"${id}\"]`);\n            if (responseRadio && (responseRadio as HTMLInputElement).checked) {\n                (responseRadio as HTMLInputElement).checked = false;\n            }\n            if (referenceRadio && (referenceRadio as HTMLInputElement).checked) {\n                (referenceRadio as HTMLInputElement).checked = false;\n            }\n            fileMap.delete(id!);\n            li.remove();\n            console.log('Removed file:', id);\n            console.log('Current file map:', fileMap);\n            saveWaveformsToStorage(fileMap);\n            // ensure analyze button is enabled/disabled\n            updateAnalyzeState();\n        }\n    });\n\n    document.getElementById('fileList').addEventListener('change', e => {\n        if (e.target.name === 'selectedResponse') {\n            // ensure analyze button is enabled/disabled\n            updateAnalyzeState();\n        }\n    });\n\n    loadWaveformsFromStorage().then(waveforms => {\n        console.log('Loaded waveforms from storage on startup:', waveforms);\n        for (const a of waveforms) {\n            const [id, audioObj] = a;\n            console.log('Creating list item for loaded waveform:', a);\n            const li = createListItem(audioObj, id); // id is not needed here since we don't remove these\n            fileMap.set(id, audioObj);\n            document.getElementById('fileList')?.appendChild(li);\n        }\n    });\n\n    document.getElementById('analyzeUploadBtn')?.addEventListener('click', () => {\n        const responseRadio = document.querySelector('input[name=\"selectedResponse\"]:checked') as HTMLInputElement;\n        const referenceRadio = document.querySelector('input[name=\"selectedReference\"]:checked') as HTMLInputElement;\n\n        if (!responseRadio) {\n            alert('Please select a response file.');\n            return;\n        }\n        console.log(fileMap.entries());\n        const response = fileMap.get(responseRadio.value);\n\n        const reference = referenceRadio ? fileMap.get(referenceRadio.value) || null : null;\n\n        if (!response) {\n            alert('Selected response file not found.');\n            return;\n        }\n\n        createAnalysisTab(response.applyGain(1 / 16384), reference ? reference.applyGain(1 / 16384) : null, response.metadata?.filename || 'Response', reference?.metadata?.filename || 'Reference');\n    });\n});\n\n// loadTestPolarData();\n// Load state on page load\nloadState();"],"mappings":"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","names":["storage","sum","sum","ext","readStr","offset","audio","max","t","window","nextPow2","window","window","window","db","recorded","audio","_a","_b","_a"]}